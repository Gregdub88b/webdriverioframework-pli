"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getAndroidPlatformAndPath = getAndroidPlatformAndPath;
exports.unzipFile = unzipFile;
exports.getIMEListFromOutput = getIMEListFromOutput;
exports.isShowingLockscreen = isShowingLockscreen;
exports.isCurrentFocusOnKeyguard = isCurrentFocusOnKeyguard;
exports.getSurfaceOrientation = getSurfaceOrientation;
exports.isScreenOnFully = isScreenOnFully;
exports.buildStartCmd = buildStartCmd;
exports.getApksignerForOs = getApksignerForOs;
exports.getApkanalyzerForOs = getApkanalyzerForOs;
exports.buildInstallArgs = buildInstallArgs;
exports.parseManifest = parseManifest;
exports.parseAaptStrings = parseAaptStrings;
exports.parseAapt2Strings = parseAapt2Strings;
exports.formatConfigMarker = formatConfigMarker;
exports.parseJsonData = parseJsonData;
exports.unsignApk = unsignApk;
exports.toAvdLocaleArgs = toAvdLocaleArgs;
exports.requireSdkRoot = requireSdkRoot;
exports.getSdkRootFromEnv = getSdkRootFromEnv;
exports.getAndroidPrefsRoot = getAndroidPrefsRoot;
exports.dirExists = dirExists;
exports.escapeArg = escapeArg;
exports.DEFAULT_ADB_EXEC_TIMEOUT = exports.APK_EXTENSION = exports.APKS_INSTALL_TIMEOUT = exports.APK_INSTALL_TIMEOUT = exports.APKS_EXTENSION = exports.extractMatchingPermissions = exports.getOpenSslForOs = exports.getBuildToolsDirs = exports.getSdkToolsVersion = exports.rootDir = exports.getJavaHome = exports.getJavaForOs = void 0;

require("source-map-support/register");

var _path = _interopRequireDefault(require("path"));

var _appiumSupport = require("appium-support");

var _logger = _interopRequireDefault(require("./logger.js"));

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _semver = _interopRequireDefault(require("semver"));

var _os = _interopRequireDefault(require("os"));

const rootDir = _path.default.resolve(__dirname, process.env.NO_PRECOMPILE ? '..' : '../..');

exports.rootDir = rootDir;
const APKS_EXTENSION = '.apks';
exports.APKS_EXTENSION = APKS_EXTENSION;
const APK_EXTENSION = '.apk';
exports.APK_EXTENSION = APK_EXTENSION;
const APK_INSTALL_TIMEOUT = 60000;
exports.APK_INSTALL_TIMEOUT = APK_INSTALL_TIMEOUT;
const APKS_INSTALL_TIMEOUT = APK_INSTALL_TIMEOUT * 2;
exports.APKS_INSTALL_TIMEOUT = APKS_INSTALL_TIMEOUT;
const DEFAULT_ADB_EXEC_TIMEOUT = 20000;
exports.DEFAULT_ADB_EXEC_TIMEOUT = DEFAULT_ADB_EXEC_TIMEOUT;

function getSdkRootFromEnv() {
  return process.env.ANDROID_HOME || process.env.ANDROID_SDK_ROOT;
}

async function requireSdkRoot(customRoot = null) {
  const sdkRoot = customRoot || getSdkRootFromEnv();
  const docMsg = 'Read https://developer.android.com/studio/command-line/variables for more details';

  if (_lodash.default.isEmpty(sdkRoot)) {
    throw new Error(`Neither ANDROID_HOME nor ANDROID_SDK_ROOT environment variable was exported. ${docMsg}`);
  }

  if (!(await _appiumSupport.fs.exists(sdkRoot))) {
    throw new Error(`The Android SDK root folder '${sdkRoot}' does not exist on the local file system. ${docMsg}`);
  }

  const stats = await _appiumSupport.fs.stat(sdkRoot);

  if (!stats.isDirectory()) {
    throw new Error(`The Android SDK root '${sdkRoot}' must be a folder. ${docMsg}`);
  }

  return sdkRoot;
}

async function getAndroidPlatformAndPath(sdkRoot) {
  const propsPaths = await _appiumSupport.fs.glob('*/build.prop', {
    cwd: _path.default.resolve(sdkRoot, 'platforms'),
    absolute: true
  });
  const platformsMapping = {};

  for (const propsPath of propsPaths) {
    const propsContent = await _appiumSupport.fs.readFile(propsPath, 'utf-8');

    const platformPath = _path.default.dirname(propsPath);

    const platform = _path.default.basename(platformPath);

    const match = /ro\.build\.version\.sdk=(\d+)/.exec(propsContent);

    if (!match) {
      _logger.default.warn(`Cannot read the SDK version from '${propsPath}'. Skipping '${platform}'`);

      continue;
    }

    platformsMapping[parseInt(match[1], 10)] = {
      platform,
      platformPath
    };
  }

  if (_lodash.default.isEmpty(platformsMapping)) {
    _logger.default.warn(`Found zero platform folders at '${_path.default.resolve(sdkRoot, 'platforms')}'. ` + `Do you have any Android SDKs installed?`);

    return {
      platform: null,
      platformPath: null
    };
  }

  const recentSdkVersion = _lodash.default.keys(platformsMapping).sort().reverse()[0];

  const result = platformsMapping[recentSdkVersion];

  _logger.default.debug(`Found the most recent Android platform: ${JSON.stringify(result)}`);

  return result;
}

async function unzipFile(zipPath, dstRoot = _path.default.dirname(zipPath)) {
  _logger.default.debug(`Unzipping '${zipPath}' to '${dstRoot}'`);

  await _appiumSupport.zip.assertValidZip(zipPath);
  await _appiumSupport.zip.extractAllTo(zipPath, dstRoot);

  _logger.default.debug('Unzip successful');
}

async function unsignApk(apkPath) {
  const tmpRoot = await _appiumSupport.tempDir.openDir();
  const metaInfFolderName = 'META-INF';

  try {
    let hasMetaInf = false;
    await _appiumSupport.zip.readEntries(apkPath, ({
      entry
    }) => {
      hasMetaInf = entry.fileName.startsWith(`${metaInfFolderName}/`);
      return !hasMetaInf;
    });

    if (!hasMetaInf) {
      return false;
    }

    const tmpZipRoot = _path.default.resolve(tmpRoot, 'apk');

    await _appiumSupport.zip.extractAllTo(apkPath, tmpZipRoot);
    await _appiumSupport.fs.rimraf(_path.default.resolve(tmpZipRoot, metaInfFolderName));

    const tmpResultPath = _path.default.resolve(tmpRoot, _path.default.basename(apkPath));

    await _appiumSupport.zip.toArchive(tmpResultPath, {
      cwd: tmpZipRoot
    });
    await _appiumSupport.fs.unlink(apkPath);
    await _appiumSupport.fs.mv(tmpResultPath, apkPath);
    return true;
  } finally {
    await _appiumSupport.fs.rimraf(tmpRoot);
  }
}

function getIMEListFromOutput(stdout) {
  let engines = [];

  for (let line of stdout.split('\n')) {
    if (line.length > 0 && line[0] !== ' ') {
      engines.push(line.trim().replace(/:$/, ''));
    }
  }

  return engines;
}

const getJavaHome = _lodash.default.memoize(async function getJavaHome() {
  const result = process.env.JAVA_HOME;

  if (!result) {
    throw new Error('The JAVA_HOME environment variable must be set for Android Tools to work properly');
  }

  if (!(await _appiumSupport.fs.exists(result))) {
    throw new Error(`The JAVA_HOME location '${result}' must exist`);
  }

  const stats = await _appiumSupport.fs.stat(result);

  if (!stats.isDirectory()) {
    throw new Error(`The JAVA_HOME location '${result}' must be a valid folder`);
  }

  return result;
});

exports.getJavaHome = getJavaHome;

const getJavaForOs = _lodash.default.memoize(async function getJavaForOs() {
  return _path.default.resolve(await getJavaHome(), 'bin', `java${_appiumSupport.system.isWindows() ? '.exe' : ''}`);
});

exports.getJavaForOs = getJavaForOs;

const getOpenSslForOs = async function () {
  const binaryName = `openssl${_appiumSupport.system.isWindows() ? '.exe' : ''}`;

  try {
    return await _appiumSupport.fs.which(binaryName);
  } catch (err) {
    throw new Error('The openssl tool must be installed on the system and available on the path');
  }
};

exports.getOpenSslForOs = getOpenSslForOs;

async function getApksignerForOs(sysHelpers) {
  return await sysHelpers.getBinaryFromSdkRoot('apksigner.jar');
}

async function getApkanalyzerForOs(sysHelpers) {
  return await sysHelpers.getBinaryFromSdkRoot('apkanalyzer');
}

function isShowingLockscreen(dumpsys) {
  return _lodash.default.some(['mShowingLockscreen=true', 'mDreamingLockscreen=true'], x => dumpsys.includes(x)) || _lodash.default.every([/KeyguardStateMonitor[\n\s]+mIsShowing=true/, /\s+mInputRestricted=true/], x => x.test(dumpsys));
}

function isCurrentFocusOnKeyguard(dumpsys) {
  let m = /mCurrentFocus.+Keyguard/gi.exec(dumpsys);
  return m && m.length && m[0] ? true : false;
}

function getSurfaceOrientation(dumpsys) {
  let m = /SurfaceOrientation: \d/gi.exec(dumpsys);
  return m && parseInt(m[0].split(':')[1], 10);
}

function isScreenOnFully(dumpsys) {
  let m = /mScreenOnFully=\w+/gi.exec(dumpsys);
  return !m || m && m.length > 0 && m[0].split('=')[1] === 'true' || false;
}

function buildStartCmd(startAppOptions, apiLevel) {
  const {
    user,
    waitForLaunch,
    pkg,
    activity,
    action,
    category,
    stopApp,
    flags
  } = startAppOptions;
  const cmd = ['am', 'start'];

  if (_appiumSupport.util.hasValue(user)) {
    cmd.push('--user', user);
  }

  if (waitForLaunch) {
    cmd.push('-W');
  }

  if (activity && pkg) {
    cmd.push('-n', `${pkg}/${activity}`);
  }

  if (stopApp && apiLevel >= 15) {
    cmd.push('-S');
  }

  if (action) {
    cmd.push('-a', action);
  }

  if (category) {
    cmd.push('-c', category);
  }

  if (flags) {
    cmd.push('-f', flags);
  }

  if (startAppOptions.optionalIntentArguments) {
    let parseKeyValue = function (str) {
      str = str.trim();
      let space = str.indexOf(' ');

      if (space === -1) {
        return str.length ? [str] : [];
      } else {
        return [str.substring(0, space).trim(), str.substring(space + 1).trim()];
      }
    };

    let optionalIntentArguments = ` ${startAppOptions.optionalIntentArguments}`;
    let re = / (-[^\s]+) (.+)/;

    while (true) {
      let args = re.exec(optionalIntentArguments);

      if (!args) {
        if (optionalIntentArguments.length) {
          cmd.push.apply(cmd, parseKeyValue(optionalIntentArguments));
        }

        break;
      }

      let flag = args[1];
      let flagPos = optionalIntentArguments.indexOf(flag);

      if (flagPos !== 0) {
        let prevArgs = optionalIntentArguments.substring(0, flagPos);
        cmd.push.apply(cmd, parseKeyValue(prevArgs));
      }

      cmd.push(flag);
      optionalIntentArguments = args[2];
    }
  }

  return cmd;
}

const getSdkToolsVersion = _lodash.default.memoize(async function getSdkToolsVersion() {
  const androidHome = process.env.ANDROID_HOME;

  if (!androidHome) {
    throw new Error('ANDROID_HOME environment variable is expected to be set');
  }

  const propertiesPath = _path.default.resolve(androidHome, 'tools', 'source.properties');

  if (!(await _appiumSupport.fs.exists(propertiesPath))) {
    _logger.default.warn(`Cannot find ${propertiesPath} file to read SDK version from`);

    return;
  }

  const propertiesContent = await _appiumSupport.fs.readFile(propertiesPath, 'utf8');
  const versionMatcher = new RegExp(/Pkg\.Revision=(\d+)\.?(\d+)?\.?(\d+)?/);
  const match = versionMatcher.exec(propertiesContent);

  if (match) {
    return {
      major: parseInt(match[1], 10),
      minor: match[2] ? parseInt(match[2], 10) : 0,
      build: match[3] ? parseInt(match[3], 10) : 0
    };
  }

  _logger.default.warn(`Cannot parse "Pkg.Revision" value from ${propertiesPath}`);
});

exports.getSdkToolsVersion = getSdkToolsVersion;

const getBuildToolsDirs = _lodash.default.memoize(async function getBuildToolsDirs(sdkRoot) {
  let buildToolsDirs = await _appiumSupport.fs.glob('*/', {
    cwd: _path.default.resolve(sdkRoot, 'build-tools'),
    absolute: true
  });

  try {
    buildToolsDirs = buildToolsDirs.map(dir => [_path.default.basename(dir), dir]).sort((a, b) => _semver.default.rcompare(a[0], b[0])).map(pair => pair[1]);
  } catch (err) {
    _logger.default.warn(`Cannot sort build-tools folders ${JSON.stringify(buildToolsDirs.map(dir => _path.default.basename(dir)))} ` + `by semantic version names.`);

    _logger.default.warn(`Falling back to sorting by modification date. Original error: ${err.message}`);

    const pairs = await _bluebird.default.map(buildToolsDirs, async dir => [(await _appiumSupport.fs.stat(dir)).mtime.valueOf(), dir]);
    buildToolsDirs = pairs.sort((a, b) => a[0] < b[0]).map(pair => pair[1]);
  }

  _logger.default.info(`Found ${buildToolsDirs.length} 'build-tools' folders under '${sdkRoot}' (newest first):`);

  for (let dir of buildToolsDirs) {
    _logger.default.info(`    ${dir}`);
  }

  return buildToolsDirs;
});

exports.getBuildToolsDirs = getBuildToolsDirs;

const extractMatchingPermissions = function (dumpsysOutput, groupNames, grantedState = null) {
  const groupPatternByName = groupName => new RegExp(`^(\\s*${_lodash.default.escapeRegExp(groupName)} permissions:[\\s\\S]+)`, 'm');

  const indentPattern = /\S|$/;
  const permissionNamePattern = /android\.\w*\.?permission\.\w+/;
  const grantedStatePattern = /\bgranted=(\w+)/;
  const result = [];

  for (const groupName of groupNames) {
    const groupMatch = groupPatternByName(groupName).exec(dumpsysOutput);

    if (!groupMatch) {
      continue;
    }

    const lines = groupMatch[1].split('\n');

    if (lines.length < 2) {
      continue;
    }

    const titleIndent = lines[0].search(indentPattern);

    for (const line of lines.slice(1)) {
      const currentIndent = line.search(indentPattern);

      if (currentIndent <= titleIndent) {
        break;
      }

      const permissionNameMatch = permissionNamePattern.exec(line);

      if (!permissionNameMatch) {
        continue;
      }

      const item = {
        permission: permissionNameMatch[0]
      };
      const grantedStateMatch = grantedStatePattern.exec(line);

      if (grantedStateMatch) {
        item.granted = grantedStateMatch[1] === 'true';
      }

      result.push(item);
    }
  }

  const filteredResult = result.filter(item => !_lodash.default.isBoolean(grantedState) || item.granted === grantedState).map(item => item.permission);

  _logger.default.debug(`Retrieved ${_appiumSupport.util.pluralize('permission', filteredResult.length, true)} ` + `from ${groupNames} ${_appiumSupport.util.pluralize('group', groupNames.length, false)}`);

  return filteredResult;
};

exports.extractMatchingPermissions = extractMatchingPermissions;

function buildInstallArgs(apiLevel, options = {}) {
  const result = [];

  if (!_appiumSupport.util.hasValue(options.replace) || options.replace) {
    result.push('-r');
  }

  if (options.allowTestPackages) {
    result.push('-t');
  }

  if (options.useSdcard) {
    result.push('-s');
  }

  if (options.grantPermissions) {
    if (apiLevel < 23) {
      _logger.default.debug(`Skipping permissions grant option, since ` + `the current API level ${apiLevel} does not support applications ` + `permissions customization`);
    } else {
      result.push('-g');
    }
  }

  if (options.partialInstall) {
    result.push('-p');
  }

  return result;
}

function parseManifest(manifest) {
  const result = {
    pkg: manifest.package,
    versionCode: parseInt(manifest.versionCode, 10),
    versionName: manifest.versionName || null
  };

  if (!manifest.application) {
    return result;
  }

  for (const activity of [...manifest.application.activities, ...manifest.application.activityAliases]) {
    if (activity.enabled === false || _lodash.default.isEmpty(activity.intentFilters)) {
      continue;
    }

    for (const {
      actions,
      categories
    } of activity.intentFilters) {
      if (_lodash.default.isEmpty(actions) || _lodash.default.isEmpty(categories)) {
        continue;
      }

      const isMainAction = actions.some(({
        name
      }) => name === 'android.intent.action.MAIN');
      const isLauncherCategory = categories.some(({
        name
      }) => name === 'android.intent.category.LAUNCHER');

      if (isMainAction && isLauncherCategory) {
        result.activity = activity.name;
        return result;
      }
    }
  }

  return result;
}

function parseAaptStrings(rawOutput, configMarker) {
  const normalizeStringMatch = function (s) {
    return s.replace(/"$/, '').replace(/^"/, '').replace(/\\"/g, '"');
  };

  const apkStrings = {};
  let isInConfig = false;
  let currentResourceId = null;
  let isInPluralGroup = false;
  const quotedStringPattern = /"[^"\\]*(?:\\.[^"\\]*)*"/;

  for (const line of rawOutput.split(_os.default.EOL)) {
    const trimmedLine = line.trim();

    if (_lodash.default.isEmpty(trimmedLine)) {
      continue;
    }

    if (['config', 'type', 'spec', 'Package'].some(x => trimmedLine.startsWith(x))) {
      isInConfig = trimmedLine.startsWith(`config ${configMarker}:`);
      currentResourceId = null;
      isInPluralGroup = false;
      continue;
    }

    if (!isInConfig) {
      continue;
    }

    if (trimmedLine.startsWith('resource')) {
      isInPluralGroup = false;
      currentResourceId = null;

      if (trimmedLine.includes(':string/')) {
        const match = /:string\/(\S+):/.exec(trimmedLine);

        if (match) {
          currentResourceId = match[1];
        }
      } else if (trimmedLine.includes(':plurals/')) {
        const match = /:plurals\/(\S+):/.exec(trimmedLine);

        if (match) {
          currentResourceId = match[1];
          isInPluralGroup = true;
        }
      }

      continue;
    }

    if (currentResourceId && trimmedLine.startsWith('(string')) {
      const match = quotedStringPattern.exec(trimmedLine);

      if (match) {
        apkStrings[currentResourceId] = normalizeStringMatch(match[0]);
      }

      currentResourceId = null;
      continue;
    }

    if (currentResourceId && isInPluralGroup && trimmedLine.includes(': (string')) {
      const match = quotedStringPattern.exec(trimmedLine);

      if (match) {
        apkStrings[currentResourceId] = [...(apkStrings[currentResourceId] || []), normalizeStringMatch(match[0])];
      }

      continue;
    }
  }

  return apkStrings;
}

function parseAapt2Strings(rawOutput, configMarker) {
  const allLines = rawOutput.split(_os.default.EOL);

  function extractContent(startIdx) {
    let idx = startIdx;
    const startCharPos = allLines[startIdx].indexOf('"');

    if (startCharPos < 0) {
      return [null, idx];
    }

    let result = '';

    while (idx < allLines.length) {
      const terminationCharMatch = /"$/.exec(allLines[idx]);

      if (terminationCharMatch) {
        const terminationCharPos = terminationCharMatch.index;

        if (startIdx === idx) {
          return [allLines[idx].substring(startCharPos + 1, terminationCharPos), idx];
        }

        return [`${result}\\n${_lodash.default.trimStart(allLines[idx].substring(0, terminationCharPos))}`, idx];
      }

      if (idx > startIdx) {
        result += `\\n${_lodash.default.trimStart(allLines[idx])}`;
      } else {
        result += allLines[idx].substring(startCharPos + 1);
      }

      ++idx;
    }

    return [result, idx];
  }

  const apkStrings = {};
  let currentResourceId = null;
  let isInPluralGroup = false;
  let isInCurrentConfig = false;
  let lineIndex = 0;

  while (lineIndex < allLines.length) {
    const trimmedLine = allLines[lineIndex].trim();

    if (_lodash.default.isEmpty(trimmedLine)) {
      ++lineIndex;
      continue;
    }

    if (['type', 'Package'].some(x => trimmedLine.startsWith(x))) {
      currentResourceId = null;
      isInPluralGroup = false;
      isInCurrentConfig = false;
      ++lineIndex;
      continue;
    }

    if (trimmedLine.startsWith('resource')) {
      isInPluralGroup = false;
      currentResourceId = null;
      isInCurrentConfig = false;

      if (trimmedLine.includes('string/')) {
        const match = /string\/(\S+)/.exec(trimmedLine);

        if (match) {
          currentResourceId = match[1];
        }
      } else if (trimmedLine.includes('plurals/')) {
        const match = /plurals\/(\S+)/.exec(trimmedLine);

        if (match) {
          currentResourceId = match[1];
          isInPluralGroup = true;
        }
      }

      ++lineIndex;
      continue;
    }

    if (currentResourceId) {
      if (isInPluralGroup) {
        if (trimmedLine.startsWith('(')) {
          isInCurrentConfig = trimmedLine.startsWith(`(${configMarker})`);
          ++lineIndex;
          continue;
        }

        if (isInCurrentConfig) {
          const [content, idx] = extractContent(lineIndex);
          lineIndex = idx;

          if (_lodash.default.isString(content)) {
            apkStrings[currentResourceId] = [...(apkStrings[currentResourceId] || []), content];
          }
        }
      } else if (trimmedLine.startsWith(`(${configMarker})`)) {
        const [content, idx] = extractContent(lineIndex);
        lineIndex = idx;

        if (_lodash.default.isString(content)) {
          apkStrings[currentResourceId] = content;
        }

        currentResourceId = null;
      }
    }

    ++lineIndex;
  }

  return apkStrings;
}

async function formatConfigMarker(configsGetter, desiredMarker, defaultMarker) {
  let configMarker = desiredMarker || defaultMarker;

  if (configMarker.includes('-') && !configMarker.includes('-r')) {
    configMarker = configMarker.replace('-', '-r');
  }

  const configs = await configsGetter();

  _logger.default.debug(`Resource configurations: ${JSON.stringify(configs)}`);

  if (configMarker.toLowerCase().startsWith('en') && !configs.some(x => x.trim() === configMarker)) {
    _logger.default.debug(`Resource configuration name '${configMarker}' is unknown. ` + `Replacing it with '${defaultMarker}'`);

    configMarker = defaultMarker;
  } else {
    _logger.default.debug(`Selected configuration: '${configMarker}'`);
  }

  return configMarker;
}

function parseJsonData(output, entityName) {
  if (!/\bresult=-1\b/.test(output) || !/\bdata="/.test(output)) {
    _logger.default.debug(output);

    throw new Error(`Cannot retrieve ${entityName} from the device. ` + 'Check the server log for more details');
  }

  const match = /\bdata=(".+)/.exec(output);

  if (!match) {
    _logger.default.debug(output);

    throw new Error(`Cannot parse ${entityName} from the command output. ` + 'Check the server log for more details');
  }

  const jsonStr = _lodash.default.trim(match[1]).replace(/(^")|("$)/g, '');

  try {
    return JSON.parse(jsonStr);
  } catch (e) {
    _logger.default.debug(jsonStr);

    throw new Error(`Cannot parse ${entityName} from the resulting data string. ` + 'Check the server log for more details');
  }
}

function toAvdLocaleArgs(language, country) {
  const result = [];

  if (language && _lodash.default.isString(language)) {
    result.push('-prop', `persist.sys.language=${language.toLowerCase()}`);
  }

  if (country && _lodash.default.isString(country)) {
    result.push('-prop', `persist.sys.country=${country.toUpperCase()}`);
  }

  let locale;

  if (_lodash.default.isString(language) && _lodash.default.isString(country) && language && country) {
    locale = language.toLowerCase() + '-' + country.toUpperCase();
  } else if (language && _lodash.default.isString(language)) {
    locale = language.toLowerCase();
  } else if (country && _lodash.default.isString(country)) {
    locale = country;
  }

  if (locale) {
    result.push('-prop', `persist.sys.locale=${locale}`);
  }

  return result;
}

async function getAndroidPrefsRoot() {
  let location = process.env.ANDROID_EMULATOR_HOME;

  if (await dirExists(location)) {
    return location;
  }

  if (location) {
    _logger.default.warn(`The value of the ANDROID_EMULATOR_HOME environment variable '${location}' is not an existing directory`);
  }

  const home = process.env.HOME || process.env.USERPROFILE;

  if (home) {
    location = _path.default.resolve(home, '.android');
  }

  if (!(await dirExists(location))) {
    _logger.default.debug(`Android config root '${location}' is not an existing directory`);

    return null;
  }

  return location;
}

async function dirExists(location) {
  return location && (await _appiumSupport.fs.exists(location)) && (await _appiumSupport.fs.stat(location)).isDirectory();
}

function escapeArg(arg) {
  arg = `${arg}`;

  if (_appiumSupport.system.isWindows()) {
    return /[&\s]/.test(arg) ? `"${arg.replace(/"/g, '""')}"` : arg;
  }

  return arg.replace(/&/g, '\\&');
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9oZWxwZXJzLmpzIl0sIm5hbWVzIjpbInJvb3REaXIiLCJwYXRoIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsInByb2Nlc3MiLCJlbnYiLCJOT19QUkVDT01QSUxFIiwiQVBLU19FWFRFTlNJT04iLCJBUEtfRVhURU5TSU9OIiwiQVBLX0lOU1RBTExfVElNRU9VVCIsIkFQS1NfSU5TVEFMTF9USU1FT1VUIiwiREVGQVVMVF9BREJfRVhFQ19USU1FT1VUIiwiZ2V0U2RrUm9vdEZyb21FbnYiLCJBTkRST0lEX0hPTUUiLCJBTkRST0lEX1NES19ST09UIiwicmVxdWlyZVNka1Jvb3QiLCJjdXN0b21Sb290Iiwic2RrUm9vdCIsImRvY01zZyIsIl8iLCJpc0VtcHR5IiwiRXJyb3IiLCJmcyIsImV4aXN0cyIsInN0YXRzIiwic3RhdCIsImlzRGlyZWN0b3J5IiwiZ2V0QW5kcm9pZFBsYXRmb3JtQW5kUGF0aCIsInByb3BzUGF0aHMiLCJnbG9iIiwiY3dkIiwiYWJzb2x1dGUiLCJwbGF0Zm9ybXNNYXBwaW5nIiwicHJvcHNQYXRoIiwicHJvcHNDb250ZW50IiwicmVhZEZpbGUiLCJwbGF0Zm9ybVBhdGgiLCJkaXJuYW1lIiwicGxhdGZvcm0iLCJiYXNlbmFtZSIsIm1hdGNoIiwiZXhlYyIsImxvZyIsIndhcm4iLCJwYXJzZUludCIsInJlY2VudFNka1ZlcnNpb24iLCJrZXlzIiwic29ydCIsInJldmVyc2UiLCJyZXN1bHQiLCJkZWJ1ZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJ1bnppcEZpbGUiLCJ6aXBQYXRoIiwiZHN0Um9vdCIsInppcCIsImFzc2VydFZhbGlkWmlwIiwiZXh0cmFjdEFsbFRvIiwidW5zaWduQXBrIiwiYXBrUGF0aCIsInRtcFJvb3QiLCJ0ZW1wRGlyIiwib3BlbkRpciIsIm1ldGFJbmZGb2xkZXJOYW1lIiwiaGFzTWV0YUluZiIsInJlYWRFbnRyaWVzIiwiZW50cnkiLCJmaWxlTmFtZSIsInN0YXJ0c1dpdGgiLCJ0bXBaaXBSb290IiwicmltcmFmIiwidG1wUmVzdWx0UGF0aCIsInRvQXJjaGl2ZSIsInVubGluayIsIm12IiwiZ2V0SU1FTGlzdEZyb21PdXRwdXQiLCJzdGRvdXQiLCJlbmdpbmVzIiwibGluZSIsInNwbGl0IiwibGVuZ3RoIiwicHVzaCIsInRyaW0iLCJyZXBsYWNlIiwiZ2V0SmF2YUhvbWUiLCJtZW1vaXplIiwiSkFWQV9IT01FIiwiZ2V0SmF2YUZvck9zIiwic3lzdGVtIiwiaXNXaW5kb3dzIiwiZ2V0T3BlblNzbEZvck9zIiwiYmluYXJ5TmFtZSIsIndoaWNoIiwiZXJyIiwiZ2V0QXBrc2lnbmVyRm9yT3MiLCJzeXNIZWxwZXJzIiwiZ2V0QmluYXJ5RnJvbVNka1Jvb3QiLCJnZXRBcGthbmFseXplckZvck9zIiwiaXNTaG93aW5nTG9ja3NjcmVlbiIsImR1bXBzeXMiLCJzb21lIiwieCIsImluY2x1ZGVzIiwiZXZlcnkiLCJ0ZXN0IiwiaXNDdXJyZW50Rm9jdXNPbktleWd1YXJkIiwibSIsImdldFN1cmZhY2VPcmllbnRhdGlvbiIsImlzU2NyZWVuT25GdWxseSIsImJ1aWxkU3RhcnRDbWQiLCJzdGFydEFwcE9wdGlvbnMiLCJhcGlMZXZlbCIsInVzZXIiLCJ3YWl0Rm9yTGF1bmNoIiwicGtnIiwiYWN0aXZpdHkiLCJhY3Rpb24iLCJjYXRlZ29yeSIsInN0b3BBcHAiLCJmbGFncyIsImNtZCIsInV0aWwiLCJoYXNWYWx1ZSIsIm9wdGlvbmFsSW50ZW50QXJndW1lbnRzIiwicGFyc2VLZXlWYWx1ZSIsInN0ciIsInNwYWNlIiwiaW5kZXhPZiIsInN1YnN0cmluZyIsInJlIiwiYXJncyIsImFwcGx5IiwiZmxhZyIsImZsYWdQb3MiLCJwcmV2QXJncyIsImdldFNka1Rvb2xzVmVyc2lvbiIsImFuZHJvaWRIb21lIiwicHJvcGVydGllc1BhdGgiLCJwcm9wZXJ0aWVzQ29udGVudCIsInZlcnNpb25NYXRjaGVyIiwiUmVnRXhwIiwibWFqb3IiLCJtaW5vciIsImJ1aWxkIiwiZ2V0QnVpbGRUb29sc0RpcnMiLCJidWlsZFRvb2xzRGlycyIsIm1hcCIsImRpciIsImEiLCJiIiwic2VtdmVyIiwicmNvbXBhcmUiLCJwYWlyIiwibWVzc2FnZSIsInBhaXJzIiwiQiIsIm10aW1lIiwidmFsdWVPZiIsImluZm8iLCJleHRyYWN0TWF0Y2hpbmdQZXJtaXNzaW9ucyIsImR1bXBzeXNPdXRwdXQiLCJncm91cE5hbWVzIiwiZ3JhbnRlZFN0YXRlIiwiZ3JvdXBQYXR0ZXJuQnlOYW1lIiwiZ3JvdXBOYW1lIiwiZXNjYXBlUmVnRXhwIiwiaW5kZW50UGF0dGVybiIsInBlcm1pc3Npb25OYW1lUGF0dGVybiIsImdyYW50ZWRTdGF0ZVBhdHRlcm4iLCJncm91cE1hdGNoIiwibGluZXMiLCJ0aXRsZUluZGVudCIsInNlYXJjaCIsInNsaWNlIiwiY3VycmVudEluZGVudCIsInBlcm1pc3Npb25OYW1lTWF0Y2giLCJpdGVtIiwicGVybWlzc2lvbiIsImdyYW50ZWRTdGF0ZU1hdGNoIiwiZ3JhbnRlZCIsImZpbHRlcmVkUmVzdWx0IiwiZmlsdGVyIiwiaXNCb29sZWFuIiwicGx1cmFsaXplIiwiYnVpbGRJbnN0YWxsQXJncyIsIm9wdGlvbnMiLCJhbGxvd1Rlc3RQYWNrYWdlcyIsInVzZVNkY2FyZCIsImdyYW50UGVybWlzc2lvbnMiLCJwYXJ0aWFsSW5zdGFsbCIsInBhcnNlTWFuaWZlc3QiLCJtYW5pZmVzdCIsInBhY2thZ2UiLCJ2ZXJzaW9uQ29kZSIsInZlcnNpb25OYW1lIiwiYXBwbGljYXRpb24iLCJhY3Rpdml0aWVzIiwiYWN0aXZpdHlBbGlhc2VzIiwiZW5hYmxlZCIsImludGVudEZpbHRlcnMiLCJhY3Rpb25zIiwiY2F0ZWdvcmllcyIsImlzTWFpbkFjdGlvbiIsIm5hbWUiLCJpc0xhdW5jaGVyQ2F0ZWdvcnkiLCJwYXJzZUFhcHRTdHJpbmdzIiwicmF3T3V0cHV0IiwiY29uZmlnTWFya2VyIiwibm9ybWFsaXplU3RyaW5nTWF0Y2giLCJzIiwiYXBrU3RyaW5ncyIsImlzSW5Db25maWciLCJjdXJyZW50UmVzb3VyY2VJZCIsImlzSW5QbHVyYWxHcm91cCIsInF1b3RlZFN0cmluZ1BhdHRlcm4iLCJvcyIsIkVPTCIsInRyaW1tZWRMaW5lIiwicGFyc2VBYXB0MlN0cmluZ3MiLCJhbGxMaW5lcyIsImV4dHJhY3RDb250ZW50Iiwic3RhcnRJZHgiLCJpZHgiLCJzdGFydENoYXJQb3MiLCJ0ZXJtaW5hdGlvbkNoYXJNYXRjaCIsInRlcm1pbmF0aW9uQ2hhclBvcyIsImluZGV4IiwidHJpbVN0YXJ0IiwiaXNJbkN1cnJlbnRDb25maWciLCJsaW5lSW5kZXgiLCJjb250ZW50IiwiaXNTdHJpbmciLCJmb3JtYXRDb25maWdNYXJrZXIiLCJjb25maWdzR2V0dGVyIiwiZGVzaXJlZE1hcmtlciIsImRlZmF1bHRNYXJrZXIiLCJjb25maWdzIiwidG9Mb3dlckNhc2UiLCJwYXJzZUpzb25EYXRhIiwib3V0cHV0IiwiZW50aXR5TmFtZSIsImpzb25TdHIiLCJwYXJzZSIsImUiLCJ0b0F2ZExvY2FsZUFyZ3MiLCJsYW5ndWFnZSIsImNvdW50cnkiLCJ0b1VwcGVyQ2FzZSIsImxvY2FsZSIsImdldEFuZHJvaWRQcmVmc1Jvb3QiLCJsb2NhdGlvbiIsIkFORFJPSURfRU1VTEFUT1JfSE9NRSIsImRpckV4aXN0cyIsImhvbWUiLCJIT01FIiwiVVNFUlBST0ZJTEUiLCJlc2NhcGVBcmciLCJhcmciXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxPQUFPLEdBQUdDLGNBQUtDLE9BQUwsQ0FBYUMsU0FBYixFQUF3QkMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLGFBQVosR0FBNEIsSUFBNUIsR0FBbUMsT0FBM0QsQ0FBaEI7OztBQUNBLE1BQU1DLGNBQWMsR0FBRyxPQUF2Qjs7QUFDQSxNQUFNQyxhQUFhLEdBQUcsTUFBdEI7O0FBQ0EsTUFBTUMsbUJBQW1CLEdBQUcsS0FBNUI7O0FBQ0EsTUFBTUMsb0JBQW9CLEdBQUdELG1CQUFtQixH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cUIsSUFBR0EsR0FBRyxDQUFDOUssT0FBSixDQUFZLElBQVosRUFBa0IsSUFBbEIsQ0FBd0IsR0FBaEQsR0FBcUQ4SyxHQUE1RDtBQUNEOztBQUNELFNBQU9BLEdBQUcsQ0FBQzlLLE9BQUosQ0FBWSxJQUFaLEVBQWtCLEtBQWxCLENBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgc3lzdGVtLCBmcywgemlwLCB1dGlsLCB0ZW1wRGlyIH0gZnJvbSAnYXBwaXVtLXN1cHBvcnQnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlci5qcyc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHNlbXZlciBmcm9tICdzZW12ZXInO1xuaW1wb3J0IG9zIGZyb20gJ29zJztcblxuY29uc3Qgcm9vdERpciA9IHBhdGgucmVzb2x2ZShfX2Rpcm5hbWUsIHByb2Nlc3MuZW52Lk5PX1BSRUNPTVBJTEUgPyAnLi4nIDogJy4uLy4uJyk7XG5jb25zdCBBUEtTX0VYVEVOU0lPTiA9ICcuYXBrcyc7XG5jb25zdCBBUEtfRVhURU5TSU9OID0gJy5hcGsnO1xuY29uc3QgQVBLX0lOU1RBTExfVElNRU9VVCA9IDYwMDAwO1xuY29uc3QgQVBLU19JTlNUQUxMX1RJTUVPVVQgPSBBUEtfSU5TVEFMTF9USU1FT1VUICogMjtcbmNvbnN0IERFRkFVTFRfQURCX0VYRUNfVElNRU9VVCA9IDIwMDAwOyAvLyBpbiBtaWxsaXNlY29uZHNcblxuLyoqXG4gKiBSZXRyaWV2ZXMgdGhlIGFjdHVhbCBwYXRoIHRvIFNESyByb290IGZvbGRlciBmcm9tIHRoZSBzeXN0ZW0gZW52aXJvbm1lbnRcbiAqXG4gKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBTREsgcm9vdCBmb2xkZXJcbiAqL1xuZnVuY3Rpb24gZ2V0U2RrUm9vdEZyb21FbnYgKCkge1xuICByZXR1cm4gcHJvY2Vzcy5lbnYuQU5EUk9JRF9IT01FIHx8IHByb2Nlc3MuZW52LkFORFJPSURfU0RLX1JPT1Q7XG59XG5cbi8qKlxuICogUmV0cmlldmVzIHRoZSBhY3R1YWwgcGF0aCB0byBTREsgcm9vdCBmb2xkZXJcbiAqXG4gKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBmdWxsIHBhdGggdG8gdGhlIFNESyByb290IGZvbGRlclxuICogQHRocm93cyB7RXJyb3J9IElmIGVpdGhlciB0aGUgY29ycmVzcG9uZGluZyBlbnYgdmFyaWFibGUgaXMgdW5zZXQgb3IgaXNcbiAqIHBvaW50aW5nIHRvIGFuIGludmFsaWQgZmlsZSBzeXN0ZW0gZW50cnlcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVxdWlyZVNka1Jvb3QgKGN1c3RvbVJvb3QgPSBudWxsKSB7XG4gIGNvbnN0IHNka1Jvb3QgPSBjdXN0b21Sb290IHx8IGdldFNka1Jvb3RGcm9tRW52KCk7XG4gIGNvbnN0IGRvY01zZyA9ICdSZWFkIGh0dHBzOi8vZGV2ZWxvcGVyLmFuZHJvaWQuY29tL3N0dWRpby9jb21tYW5kLWxpbmUvdmFyaWFibGVzIGZvciBtb3JlIGRldGFpbHMnO1xuICBpZiAoXy5pc0VtcHR5KHNka1Jvb3QpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBOZWl0aGVyIEFORFJPSURfSE9NRSBub3IgQU5EUk9JRF9TREtfUk9PVCBlbnZpcm9ubWVudCB2YXJpYWJsZSB3YXMgZXhwb3J0ZWQuICR7ZG9jTXNnfWApO1xuICB9XG5cbiAgaWYgKCFhd2FpdCBmcy5leGlzdHMoc2RrUm9vdCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBBbmRyb2lkIFNESyByb290IGZvbGRlciAnJHtzZGtSb290fScgZG9lcyBub3QgZXhpc3Qgb24gdGhlIGxvY2FsIGZpbGUgc3lzdGVtLiAke2RvY01zZ31gKTtcbiAgfVxuICBjb25zdCBzdGF0cyA9IGF3YWl0IGZzLnN0YXQoc2RrUm9vdCk7XG4gIGlmICghc3RhdHMuaXNEaXJlY3RvcnkoKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVGhlIEFuZHJvaWQgU0RLIHJvb3QgJyR7c2RrUm9vdH0nIG11c3QgYmUgYSBmb2xkZXIuICR7ZG9jTXNnfWApO1xuICB9XG4gIHJldHVybiBzZGtSb290O1xufVxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFBsYXRmb3JtSW5mb1xuICogQHByb3BlcnR5IHs/c3RyaW5nfSBwbGF0Zm9ybSAtIFRoZSBwbGF0Zm9ybSBuYW1lLCBmb3IgZXhhbXBsZSBgYW5kcm9pZC0yNGBcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBgbnVsbGAgaWYgaXQgY2Fubm90IGJlIGZvdW5kXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHBsYXRmb3JtUGF0aCAtIEZ1bGwgcGF0aCB0byB0aGUgcGxhdGZvcm0gU0RLIGZvbGRlclxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvciBgbnVsbGAgaWYgaXQgY2Fubm90IGJlIGZvdW5kXG4gKi9cblxuLyoqXG4gKiBSZXRyaWV2ZSB0aGUgcGF0aCB0byB0aGUgcmVjZW50IGluc3RhbGxlZCBBbmRyb2lkIHBsYXRmb3JtLlxuICpcbiAqIEByZXR1cm4ge1BsYXRmb3JtSW5mb30gVGhlIHJlc3VsdGluZyBwYXRoIHRvIHRoZSBuZXdlc3QgaW5zdGFsbGVkIHBsYXRmb3JtLlxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRBbmRyb2lkUGxhdGZvcm1BbmRQYXRoIChzZGtSb290KSB7XG4gIGNvbnN0IHByb3BzUGF0aHMgPSBhd2FpdCBmcy5nbG9iKCcqL2J1aWxkLnByb3AnLCB7XG4gICAgY3dkOiBwYXRoLnJlc29sdmUoc2RrUm9vdCwgJ3BsYXRmb3JtcycpLFxuICAgIGFic29sdXRlOiB0cnVlLFxuICB9KTtcbiAgY29uc3QgcGxhdGZvcm1zTWFwcGluZyA9IHt9O1xuICBmb3IgKGNvbnN0IHByb3BzUGF0aCBvZiBwcm9wc1BhdGhzKSB7XG4gICAgY29uc3QgcHJvcHNDb250ZW50ID0gYXdhaXQgZnMucmVhZEZpbGUocHJvcHNQYXRoLCAndXRmLTgnKTtcbiAgICBjb25zdCBwbGF0Zm9ybVBhdGggPSBwYXRoLmRpcm5hbWUocHJvcHNQYXRoKTtcbiAgICBjb25zdCBwbGF0Zm9ybSA9IHBhdGguYmFzZW5hbWUocGxhdGZvcm1QYXRoKTtcbiAgICBjb25zdCBtYXRjaCA9IC9yb1xcLmJ1aWxkXFwudmVyc2lvblxcLnNkaz0oXFxkKykvLmV4ZWMocHJvcHNDb250ZW50KTtcbiAgICBpZiAoIW1hdGNoKSB7XG4gICAgICBsb2cud2FybihgQ2Fubm90IHJlYWQgdGhlIFNESyB2ZXJzaW9uIGZyb20gJyR7cHJvcHNQYXRofScuIFNraXBwaW5nICcke3BsYXRmb3JtfSdgKTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBwbGF0Zm9ybXNNYXBwaW5nW3BhcnNlSW50KG1hdGNoWzFdLCAxMCldID0ge1xuICAgICAgcGxhdGZvcm0sXG4gICAgICBwbGF0Zm9ybVBhdGgsXG4gICAgfTtcbiAgfVxuICBpZiAoXy5pc0VtcHR5KHBsYXRmb3Jtc01hcHBpbmcpKSB7XG4gICAgbG9nLndhcm4oYEZvdW5kIHplcm8gcGxhdGZvcm0gZm9sZGVycyBhdCAnJHtwYXRoLnJlc29sdmUoc2RrUm9vdCwgJ3BsYXRmb3JtcycpfScuIGAgK1xuICAgICAgYERvIHlvdSBoYXZlIGFueSBBbmRyb2lkIFNES3MgaW5zdGFsbGVkP2ApO1xuICAgIHJldHVybiB7XG4gICAgICBwbGF0Zm9ybTogbnVsbCxcbiAgICAgIHBsYXRmb3JtUGF0aDogbnVsbCxcbiAgICB9O1xuICB9XG5cbiAgY29uc3QgcmVjZW50U2RrVmVyc2lvbiA9IF8ua2V5cyhwbGF0Zm9ybXNNYXBwaW5nKS5zb3J0KCkucmV2ZXJzZSgpWzBdO1xuICBjb25zdCByZXN1bHQgPSBwbGF0Zm9ybXNNYXBwaW5nW3JlY2VudFNka1ZlcnNpb25dO1xuICBsb2cuZGVidWcoYEZvdW5kIHRoZSBtb3N0IHJlY2VudCBBbmRyb2lkIHBsYXRmb3JtOiAke0pTT04uc3RyaW5naWZ5KHJlc3VsdCl9YCk7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHVuemlwRmlsZSAoemlwUGF0aCwgZHN0Um9vdCA9IHBhdGguZGlybmFtZSh6aXBQYXRoKSkge1xuICBsb2cuZGVidWcoYFVuemlwcGluZyAnJHt6aXBQYXRofScgdG8gJyR7ZHN0Um9vdH0nYCk7XG4gIGF3YWl0IHppcC5hc3NlcnRWYWxpZFppcCh6aXBQYXRoKTtcbiAgYXdhaXQgemlwLmV4dHJhY3RBbGxUbyh6aXBQYXRoLCBkc3RSb290KTtcbiAgbG9nLmRlYnVnKCdVbnppcCBzdWNjZXNzZnVsJyk7XG59XG5cbi8qKlxuICogVW5zaWducyB0aGUgZ2l2ZW4gYXBrIGJ5IHJlbW92aW5nIHRoZVxuICogTUVUQS1JTkYgZm9sZGVyIHJlY3Vyc2l2ZWx5IGZyb20gdGhlIGFyY2hpdmUuXG4gKiAhISEgVGhlIGZ1bmN0aW9uIG92ZXJ3cml0ZXMgdGhlIGdpdmVuIGFwayBhZnRlciBzdWNjZXNzZnVsIHVuc2lnbmluZyAhISFcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBrUGF0aCBUaGUgcGF0aCB0byB0aGUgYXBrXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gYHRydWVgIGlmIHRoZSBhcGsgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5XG4gKiB1bnNpZ25lZCBhbmQgb3ZlcndyaXR0ZW5cbiAqIEB0aHJvd3Mge0Vycm9yfSBpZiB0aGVyZSB3YXMgYW4gZXJyb3IgZHVyaW5nIHRoZSB1bnNpZ24gb3BlcmF0aW9uXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHVuc2lnbkFwayAoYXBrUGF0aCkge1xuICBjb25zdCB0bXBSb290ID0gYXdhaXQgdGVtcERpci5vcGVuRGlyKCk7XG4gIGNvbnN0IG1ldGFJbmZGb2xkZXJOYW1lID0gJ01FVEEtSU5GJztcbiAgdHJ5IHtcbiAgICBsZXQgaGFzTWV0YUluZiA9IGZhbHNlO1xuICAgIGF3YWl0IHppcC5yZWFkRW50cmllcyhhcGtQYXRoLCAoe2VudHJ5fSkgPT4ge1xuICAgICAgaGFzTWV0YUluZiA9IGVudHJ5LmZpbGVOYW1lLnN0YXJ0c1dpdGgoYCR7bWV0YUluZkZvbGRlck5hbWV9L2ApO1xuICAgICAgLy8gZW50cmllcyBpdGVyYXRpb24gc3RvcHMgYWZ0ZXIgYGZhbHNlYCBpcyByZXR1cm5lZFxuICAgICAgcmV0dXJuICFoYXNNZXRhSW5mO1xuICAgIH0pO1xuICAgIGlmICghaGFzTWV0YUluZikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCB0bXBaaXBSb290ID0gcGF0aC5yZXNvbHZlKHRtcFJvb3QsICdhcGsnKTtcbiAgICBhd2FpdCB6aXAuZXh0cmFjdEFsbFRvKGFwa1BhdGgsIHRtcFppcFJvb3QpO1xuICAgIGF3YWl0IGZzLnJpbXJhZihwYXRoLnJlc29sdmUodG1wWmlwUm9vdCwgbWV0YUluZkZvbGRlck5hbWUpKTtcbiAgICBjb25zdCB0bXBSZXN1bHRQYXRoID0gcGF0aC5yZXNvbHZlKHRtcFJvb3QsIHBhdGguYmFzZW5hbWUoYXBrUGF0aCkpO1xuICAgIGF3YWl0IHppcC50b0FyY2hpdmUodG1wUmVzdWx0UGF0aCwge1xuICAgICAgY3dkOiB0bXBaaXBSb290LFxuICAgIH0pO1xuICAgIGF3YWl0IGZzLnVubGluayhhcGtQYXRoKTtcbiAgICBhd2FpdCBmcy5tdih0bXBSZXN1bHRQYXRoLCBhcGtQYXRoKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBmaW5hbGx5IHtcbiAgICBhd2FpdCBmcy5yaW1yYWYodG1wUm9vdCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0SU1FTGlzdEZyb21PdXRwdXQgKHN0ZG91dCkge1xuICBsZXQgZW5naW5lcyA9IFtdO1xuICBmb3IgKGxldCBsaW5lIG9mIHN0ZG91dC5zcGxpdCgnXFxuJykpIHtcbiAgICBpZiAobGluZS5sZW5ndGggPiAwICYmIGxpbmVbMF0gIT09ICcgJykge1xuICAgICAgLy8gcmVtb3ZlIG5ld2xpbmUgYW5kIHRyYWlsaW5nIGNvbG9uLCBhbmQgYWRkIHRvIHRoZSBsaXN0XG4gICAgICBlbmdpbmVzLnB1c2gobGluZS50cmltKCkucmVwbGFjZSgvOiQvLCAnJykpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZW5naW5lcztcbn1cblxuY29uc3QgZ2V0SmF2YUhvbWUgPSBfLm1lbW9pemUoYXN5bmMgZnVuY3Rpb24gZ2V0SmF2YUhvbWUgKCkge1xuICBjb25zdCByZXN1bHQgPSBwcm9jZXNzLmVudi5KQVZBX0hPTUU7XG4gIGlmICghcmVzdWx0KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgSkFWQV9IT01FIGVudmlyb25tZW50IHZhcmlhYmxlIG11c3QgYmUgc2V0IGZvciBBbmRyb2lkIFRvb2xzIHRvIHdvcmsgcHJvcGVybHknKTtcbiAgfVxuICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhyZXN1bHQpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgSkFWQV9IT01FIGxvY2F0aW9uICcke3Jlc3VsdH0nIG11c3QgZXhpc3RgKTtcbiAgfVxuICBjb25zdCBzdGF0cyA9IGF3YWl0IGZzLnN0YXQocmVzdWx0KTtcbiAgaWYgKCFzdGF0cy5pc0RpcmVjdG9yeSgpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgSkFWQV9IT01FIGxvY2F0aW9uICcke3Jlc3VsdH0nIG11c3QgYmUgYSB2YWxpZCBmb2xkZXJgKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufSk7XG5cbmNvbnN0IGdldEphdmFGb3JPcyA9IF8ubWVtb2l6ZShhc3luYyBmdW5jdGlvbiBnZXRKYXZhRm9yT3MgKCkge1xuICByZXR1cm4gcGF0aC5yZXNvbHZlKGF3YWl0IGdldEphdmFIb21lKCksICdiaW4nLFxuICAgIGBqYXZhJHtzeXN0ZW0uaXNXaW5kb3dzKCkgPyAnLmV4ZScgOiAnJ31gKTtcbn0pO1xuXG5jb25zdCBnZXRPcGVuU3NsRm9yT3MgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gIGNvbnN0IGJpbmFyeU5hbWUgPSBgb3BlbnNzbCR7c3lzdGVtLmlzV2luZG93cygpID8gJy5leGUnIDogJyd9YDtcbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgZnMud2hpY2goYmluYXJ5TmFtZSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHRocm93IG5ldyBFcnJvcignVGhlIG9wZW5zc2wgdG9vbCBtdXN0IGJlIGluc3RhbGxlZCBvbiB0aGUgc3lzdGVtIGFuZCBhdmFpbGFibGUgb24gdGhlIHBhdGgnKTtcbiAgfVxufTtcblxuLyoqXG4gKiBHZXQgdGhlIGFic29sdXRlIHBhdGggdG8gYXBrc2lnbmVyIHRvb2xcbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gc3lzSGVscGVycyAtIEFuIGluc3RhbmNlIGNvbnRhaW5pbmcgc3lzdGVtQ2FsbE1ldGhvZHMgaGVscGVyIG1ldGhvZHNcbiAqIEByZXR1cm5zIHtzdHJpbmd9IEFuIGFic29sdXRlIHBhdGggdG8gYXBrc2lnbmVyIHRvb2wuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHRvb2wgaXMgbm90IHByZXNlbnQgb24gdGhlIGxvY2FsIGZpbGUgc3lzdGVtLlxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRBcGtzaWduZXJGb3JPcyAoc3lzSGVscGVycykge1xuICByZXR1cm4gYXdhaXQgc3lzSGVscGVycy5nZXRCaW5hcnlGcm9tU2RrUm9vdCgnYXBrc2lnbmVyLmphcicpO1xufVxuXG4vKipcbiAqIEdldCB0aGUgYWJzb2x1dGUgcGF0aCB0byBhcGthbmFseXplciB0b29sLlxuICogaHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vc3R1ZGlvL2NvbW1hbmQtbGluZS9hcGthbmFseXplci5odG1sXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IHN5c0hlbHBlcnMgLSBBbiBpbnN0YW5jZSBjb250YWluaW5nIHN5c3RlbUNhbGxNZXRob2RzIGhlbHBlciBtZXRob2RzXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBBbiBhYnNvbHV0ZSBwYXRoIHRvIGFwa2FuYWx5emVyIHRvb2wuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHRvb2wgaXMgbm90IHByZXNlbnQgb24gdGhlIGxvY2FsIGZpbGUgc3lzdGVtLlxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRBcGthbmFseXplckZvck9zIChzeXNIZWxwZXJzKSB7XG4gIHJldHVybiBhd2FpdCBzeXNIZWxwZXJzLmdldEJpbmFyeUZyb21TZGtSb290KCdhcGthbmFseXplcicpO1xufVxuXG4vKipcbiAqIENoZWNrcyBtU2hvd2luZ0xvY2tzY3JlZW4gb3IgbURyZWFtaW5nTG9ja3NjcmVlbiBpbiBkdW1wc3lzIG91dHB1dCB0byBkZXRlcm1pbmVcbiAqIGlmIGxvY2sgc2NyZWVuIGlzIHNob3dpbmdcbiAqXG4gKiBBIG5vdGU6IGBhZGIgc2hlbGwgZHVtcHN5cyB0cnVzdGAgcGVyZm9ybXMgYmV0dGVyIHdoaWxlIGRldGVjdGluZyB0aGUgbG9ja2VkIHNjcmVlbiBzdGF0ZVxuICogaW4gY29tcGFyaXNvbiB0byBgYWRiIGR1bXBzeXMgd2luZG93YCBvdXRwdXQgcGFyc2luZy5cbiAqIEJ1dCB0aGUgdHJ1c3QgY29tbWFuZCBkb2VzIG5vdCB3b3JrIGZvciBgU3dpcGVgIHVubG9jayBwYXR0ZXJuLlxuICpcbiAqIEluIHNvbWUgQW5kcm9pZCBkZXZpY2VzIChQcm9iYWJseSBhcm91bmQgQW5kcm9pZCAxMCspLCBgbVNob3dpbmdMb2Nrc2NyZWVuYCBhbmQgYG1EcmVhbWluZ0xvY2tzY3JlZW5gXG4gKiBkbyBub3Qgd29yayB0byBkZXRlY3QgbG9jayBzdGF0dXMuIEluc3RlYWQsIGtleWd1YXJkIHByZWZlcmVuY2VzIGhlbHBzIHRvIGRldGVjdCB0aGUgbG9jayBjb25kaXRpb24uXG4gKiBTb21lIGRldmljZXMgc3VjaCBhcyBBbmRyb2lkIFRWIGRvIG5vdCBoYXZlIGtleWd1YXJkLCBzbyB3ZSBzaG91bGQga2VlcFxuICogc2NyZWVuIGNvbmRpdGlvbiBhcyB0aGlzIHByaW1hcnkgbWV0aG9kLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBkdW1wc3lzIC0gVGhlIG91dHB1dCBvZiBkdW1wc3lzIHdpbmRvdyBjb21tYW5kLlxuICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiBsb2NrIHNjcmVlbiBpcyBzaG93aW5nLlxuICovXG5mdW5jdGlvbiBpc1Nob3dpbmdMb2Nrc2NyZWVuIChkdW1wc3lzKSB7XG4gIHJldHVybiBfLnNvbWUoWydtU2hvd2luZ0xvY2tzY3JlZW49dHJ1ZScsICdtRHJlYW1pbmdMb2Nrc2NyZWVuPXRydWUnXSwgKHgpID0+IGR1bXBzeXMuaW5jbHVkZXMoeCkpXG4gICAgLy8gYG1Jc1Nob3dpbmdgIGFuZCBgbUlucHV0UmVzdHJpY3RlZGAgYXJlIGB0cnVlYCBpbiBsb2NrIGNvbmRpdGlvbi4gYGZhbHNlYCBpcyB1bmxvY2sgY29uZGl0aW9uLlxuICAgIHx8IF8uZXZlcnkoWy9LZXlndWFyZFN0YXRlTW9uaXRvcltcXG5cXHNdK21Jc1Nob3dpbmc9dHJ1ZS8sIC9cXHMrbUlucHV0UmVzdHJpY3RlZD10cnVlL10sICh4KSA9PiB4LnRlc3QoZHVtcHN5cykpO1xufVxuXG4vKlxuICogQ2hlY2tzIG1DdXJyZW50Rm9jdXMgaW4gZHVtcHN5cyBvdXRwdXQgdG8gZGV0ZXJtaW5lIGlmIEtleWd1YXJkIGlzIGFjdGl2YXRlZFxuICovXG5mdW5jdGlvbiBpc0N1cnJlbnRGb2N1c09uS2V5Z3VhcmQgKGR1bXBzeXMpIHtcbiAgbGV0IG0gPSAvbUN1cnJlbnRGb2N1cy4rS2V5Z3VhcmQvZ2kuZXhlYyhkdW1wc3lzKTtcbiAgcmV0dXJuIChtICYmIG0ubGVuZ3RoICYmIG1bMF0pID8gdHJ1ZSA6IGZhbHNlO1xufVxuXG4vKlxuICogUmVhZHMgU3VyZmFjZU9yaWVudGF0aW9uIGluIGR1bXBzeXMgb3V0cHV0XG4gKi9cbmZ1bmN0aW9uIGdldFN1cmZhY2VPcmllbnRhdGlvbiAoZHVtcHN5cykge1xuICBsZXQgbSA9IC9TdXJmYWNlT3JpZW50YXRpb246IFxcZC9naS5leGVjKGR1bXBzeXMpO1xuICByZXR1cm4gbSAmJiBwYXJzZUludChtWzBdLnNwbGl0KCc6JylbMV0sIDEwKTtcbn1cblxuLypcbiAqIENoZWNrcyBtU2NyZWVuT25GdWxseSBpbiBkdW1wc3lzIG91dHB1dCB0byBkZXRlcm1pbmUgaWYgc2NyZWVuIGlzIHNob3dpbmdcbiAqIERlZmF1bHQgaXMgdHJ1ZVxuICovXG5mdW5jdGlvbiBpc1NjcmVlbk9uRnVsbHkgKGR1bXBzeXMpIHtcbiAgbGV0IG0gPSAvbVNjcmVlbk9uRnVsbHk9XFx3Ky9naS5leGVjKGR1bXBzeXMpO1xuICByZXR1cm4gIW0gfHwgLy8gaWYgaW5mb3JtYXRpb24gaXMgbWlzc2luZyB3ZSBhc3N1bWUgc2NyZWVuIGlzIGZ1bGx5IG9uXG4gICAgICAgICAobSAmJiBtLmxlbmd0aCA+IDAgJiYgbVswXS5zcGxpdCgnPScpWzFdID09PSAndHJ1ZScpIHx8IGZhbHNlO1xufVxuXG4vKipcbiAqIEJ1aWxkcyBjb21tYW5kIGxpbmUgcmVwcmVzZW50YXRpb24gZm9yIHRoZSBnaXZlblxuICogYXBwbGljYXRpb24gc3RhcnR1cCBvcHRpb25zXG4gKlxuICogQHBhcmFtIHtTdGFydEFwcE9wdGlvbnN9IHN0YXJ0QXBwT3B0aW9ucyAtIEFwcGxpY2F0aW9uIG9wdGlvbnMgbWFwcGluZ1xuICogQHBhcmFtIHtudW1iZXJ9IGFwaUxldmVsIC0gVGhlIGFjdHVhbCBPUyBBUEkgbGV2ZWxcbiAqIEByZXR1cm5zIHtBcnJheTxTdHJpbmc+fSBUaGUgYWN0dWFsIGNvbW1hbmQgbGluZSBhcnJheVxuICovXG5mdW5jdGlvbiBidWlsZFN0YXJ0Q21kIChzdGFydEFwcE9wdGlvbnMsIGFwaUxldmVsKSB7XG4gIGNvbnN0IHtcbiAgICB1c2VyLFxuICAgIHdhaXRGb3JMYXVuY2gsXG4gICAgcGtnLFxuICAgIGFjdGl2aXR5LFxuICAgIGFjdGlvbixcbiAgICBjYXRlZ29yeSxcbiAgICBzdG9wQXBwLFxuICAgIGZsYWdzLFxuICB9ID0gc3RhcnRBcHBPcHRpb25zO1xuICBjb25zdCBjbWQgPSBbJ2FtJywgJ3N0YXJ0J107XG4gIGlmICh1dGlsLmhhc1ZhbHVlKHVzZXIpKSB7XG4gICAgY21kLnB1c2goJy0tdXNlcicsIHVzZXIpO1xuICB9XG4gIGlmICh3YWl0Rm9yTGF1bmNoKSB7XG4gICAgY21kLnB1c2goJy1XJyk7XG4gIH1cbiAgaWYgKGFjdGl2aXR5ICYmIHBrZykge1xuICAgIGNtZC5wdXNoKCctbicsIGAke3BrZ30vJHthY3Rpdml0eX1gKTtcbiAgfVxuICBpZiAoc3RvcEFwcCAmJiBhcGlMZXZlbCA+PSAxNSkge1xuICAgIGNtZC5wdXNoKCctUycpO1xuICB9XG4gIGlmIChhY3Rpb24pIHtcbiAgICBjbWQucHVzaCgnLWEnLCBhY3Rpb24pO1xuICB9XG4gIGlmIChjYXRlZ29yeSkge1xuICAgIGNtZC5wdXNoKCctYycsIGNhdGVnb3J5KTtcbiAgfVxuICBpZiAoZmxhZ3MpIHtcbiAgICBjbWQucHVzaCgnLWYnLCBmbGFncyk7XG4gIH1cbiAgaWYgKHN0YXJ0QXBwT3B0aW9ucy5vcHRpb25hbEludGVudEFyZ3VtZW50cykge1xuICAgIC8vIGV4cGVjdCBvcHRpb25hbEludGVudEFyZ3VtZW50cyB0byBiZSBhIHNpbmdsZSBzdHJpbmcgb2YgdGhlIGZvcm06XG4gICAgLy8gICAgIFwiLWZsYWcga2V5XCJcbiAgICAvLyAgICAgXCItZmxhZyBrZXkgdmFsdWVcIlxuICAgIC8vIG9yIGEgY29tYmluYXRpb24gb2YgdGhlc2UgKGUuZy4sIFwiLWZsYWcxIGtleTEgLWZsYWcyIGtleTIgdmFsdWUyXCIpXG5cbiAgICAvLyB0YWtlIGEgc3RyaW5nIGFuZCBwYXJzZSBvdXQgdGhlIHBhcnQgYmVmb3JlIGFueSBzcGFjZXMsIGFuZCBhbnl0aGluZyBhZnRlclxuICAgIC8vIHRoZSBmaXJzdCBzcGFjZVxuICAgIGxldCBwYXJzZUtleVZhbHVlID0gZnVuY3Rpb24gKHN0cikge1xuICAgICAgc3RyID0gc3RyLnRyaW0oKTtcbiAgICAgIGxldCBzcGFjZSA9IHN0ci5pbmRleE9mKCcgJyk7XG4gICAgICBpZiAoc3BhY2UgPT09IC0xKSB7XG4gICAgICAgIHJldHVybiBzdHIubGVuZ3RoID8gW3N0cl0gOiBbXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBbc3RyLnN1YnN0cmluZygwLCBzcGFjZSkudHJpbSgpLCBzdHIuc3Vic3RyaW5nKHNwYWNlICsgMSkudHJpbSgpXTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gY3ljbGUgdGhyb3VnaCB0aGUgb3B0aW9uYWxJbnRlbnRBcmd1bWVudHMgYW5kIHB1bGwgb3V0IHRoZSBhcmd1bWVudHNcbiAgICAvLyBhZGQgYSBzcGFjZSBpbml0aWFsbHkgc28gZmxhZ3MgY2FuIGJlIGRpc3Rpbmd1aXNoZWQgZnJvbSBhcmd1bWVudHMgdGhhdFxuICAgIC8vIGhhdmUgaW50ZXJuYWwgaHlwaGVuc1xuICAgIGxldCBvcHRpb25hbEludGVudEFyZ3VtZW50cyA9IGAgJHtzdGFydEFwcE9wdGlvbnMub3B0aW9uYWxJbnRlbnRBcmd1bWVudHN9YDtcbiAgICBsZXQgcmUgPSAvICgtW15cXHNdKykgKC4rKS87XG4gICAgd2hpbGUgKHRydWUpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1jb25zdGFudC1jb25kaXRpb25cbiAgICAgIGxldCBhcmdzID0gcmUuZXhlYyhvcHRpb25hbEludGVudEFyZ3VtZW50cyk7XG4gICAgICBpZiAoIWFyZ3MpIHtcbiAgICAgICAgaWYgKG9wdGlvbmFsSW50ZW50QXJndW1lbnRzLmxlbmd0aCkge1xuICAgICAgICAgIC8vIG5vIG1vcmUgZmxhZ3MsIHNvIHRoZSByZW1haW5kZXIgY2FuIGJlIHRyZWF0ZWQgYXMgJ2tleScgb3IgJ2tleSB2YWx1ZSdcbiAgICAgICAgICBjbWQucHVzaC5hcHBseShjbWQsIHBhcnNlS2V5VmFsdWUob3B0aW9uYWxJbnRlbnRBcmd1bWVudHMpKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB3ZSBhcmUgZG9uZVxuICAgICAgICBicmVhaztcbiAgICAgIH1cblxuICAgICAgLy8gdGFrZSB0aGUgZmxhZyBhbmQgc2VlIGlmIGl0IGlzIGF0IHRoZSBiZWdpbm5pbmcgb2YgdGhlIHN0cmluZ1xuICAgICAgLy8gaWYgaXQgaXMgbm90LCB0aGVuIGl0IG1lYW5zIHdlIGhhdmUgYmVlbiB0aHJvdWdoIGFscmVhZHksIGFuZFxuICAgICAgLy8gd2hhdCBpcyBiZWZvcmUgdGhlIGZsYWcgaXMgdGhlIGFyZ3VtZW50IGZvciB0aGUgcHJldmlvdXMgZmxhZ1xuICAgICAgbGV0IGZsYWcgPSBhcmdzWzFdO1xuICAgICAgbGV0IGZsYWdQb3MgPSBvcHRpb25hbEludGVudEFyZ3VtZW50cy5pbmRleE9mKGZsYWcpO1xuICAgICAgaWYgKGZsYWdQb3MgIT09IDApIHtcbiAgICAgICAgbGV0IHByZXZBcmdzID0gb3B0aW9uYWxJbnRlbnRBcmd1bWVudHMuc3Vic3RyaW5nKDAsIGZsYWdQb3MpO1xuICAgICAgICBjbWQucHVzaC5hcHBseShjbWQsIHBhcnNlS2V5VmFsdWUocHJldkFyZ3MpKTtcbiAgICAgIH1cblxuICAgICAgLy8gYWRkIHRoZSBmbGFnLCBhcyB0aGVyZSBhcmUgbm8gbW9yZSBlYXJsaWVyIGFyZ3VtZW50c1xuICAgICAgY21kLnB1c2goZmxhZyk7XG5cbiAgICAgIC8vIG1ha2Ugb3B0aW9uYWxJbnRlbnRBcmd1bWVudHMgaG9sZCB0aGUgcmVtYWluZGVyXG4gICAgICBvcHRpb25hbEludGVudEFyZ3VtZW50cyA9IGFyZ3NbMl07XG4gICAgfVxuICB9XG4gIHJldHVybiBjbWQ7XG59XG5cbmNvbnN0IGdldFNka1Rvb2xzVmVyc2lvbiA9IF8ubWVtb2l6ZShhc3luYyBmdW5jdGlvbiBnZXRTZGtUb29sc1ZlcnNpb24gKCkge1xuICBjb25zdCBhbmRyb2lkSG9tZSA9IHByb2Nlc3MuZW52LkFORFJPSURfSE9NRTtcbiAgaWYgKCFhbmRyb2lkSG9tZSkge1xuICAgIHRocm93IG5ldyBFcnJvcignQU5EUk9JRF9IT01FIGVudmlyb25tZW50IHZhcmlhYmxlIGlzIGV4cGVjdGVkIHRvIGJlIHNldCcpO1xuICB9XG4gIGNvbnN0IHByb3BlcnRpZXNQYXRoID0gcGF0aC5yZXNvbHZlKGFuZHJvaWRIb21lLCAndG9vbHMnLCAnc291cmNlLnByb3BlcnRpZXMnKTtcbiAgaWYgKCFhd2FpdCBmcy5leGlzdHMocHJvcGVydGllc1BhdGgpKSB7XG4gICAgbG9nLndhcm4oYENhbm5vdCBmaW5kICR7cHJvcGVydGllc1BhdGh9IGZpbGUgdG8gcmVhZCBTREsgdmVyc2lvbiBmcm9tYCk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHByb3BlcnRpZXNDb250ZW50ID0gYXdhaXQgZnMucmVhZEZpbGUocHJvcGVydGllc1BhdGgsICd1dGY4Jyk7XG4gIGNvbnN0IHZlcnNpb25NYXRjaGVyID0gbmV3IFJlZ0V4cCgvUGtnXFwuUmV2aXNpb249KFxcZCspXFwuPyhcXGQrKT9cXC4/KFxcZCspPy8pO1xuICBjb25zdCBtYXRjaCA9IHZlcnNpb25NYXRjaGVyLmV4ZWMocHJvcGVydGllc0NvbnRlbnQpO1xuICBpZiAobWF0Y2gpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbWFqb3I6IHBhcnNlSW50KG1hdGNoWzFdLCAxMCksXG4gICAgICBtaW5vcjogbWF0Y2hbMl0gPyBwYXJzZUludChtYXRjaFsyXSwgMTApIDogMCxcbiAgICAgIGJ1aWxkOiBtYXRjaFszXSA/IHBhcnNlSW50KG1hdGNoWzNdLCAxMCkgOiAwXG4gICAgfTtcbiAgfVxuICBsb2cud2FybihgQ2Fubm90IHBhcnNlIFwiUGtnLlJldmlzaW9uXCIgdmFsdWUgZnJvbSAke3Byb3BlcnRpZXNQYXRofWApO1xufSk7XG5cbi8qKlxuICogUmV0cmlldmVzIGZ1bGwgcGF0aHMgdG8gYWxsICdidWlsZC10b29scycgc3ViZm9sZGVycyB1bmRlciB0aGUgcGFydGljdWxhclxuICogU0RLIHJvb3QgZm9sZGVyXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHNka1Jvb3QgLSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBBbmRyb2lkIFNESyByb290IGZvbGRlclxuICogQHJldHVybnMge0FycmF5PHN0cmluZz59IFRoZSBmdWxsIHBhdGhzIHRvIHRoZSByZXN1bHRpbmcgZm9sZGVycyBzb3J0ZWQgYnlcbiAqIG1vZGlmaWNhdGlvbiBkYXRlICh0aGUgbmV3ZXN0IGNvbWVzIGZpcnN0KSBvciBhbiBlbXB0eSBsaXN0IGlmIG5vIG1hY3RoZXMgd2VyZSBmb3VuZFxuICovXG5jb25zdCBnZXRCdWlsZFRvb2xzRGlycyA9IF8ubWVtb2l6ZShhc3luYyBmdW5jdGlvbiBnZXRCdWlsZFRvb2xzRGlycyAoc2RrUm9vdCkge1xuICBsZXQgYnVpbGRUb29sc0RpcnMgPSBhd2FpdCBmcy5nbG9iKCcqLycsIHtcbiAgICBjd2Q6IHBhdGgucmVzb2x2ZShzZGtSb290LCAnYnVpbGQtdG9vbHMnKSxcbiAgICBhYnNvbHV0ZTogdHJ1ZSxcbiAgfSk7XG4gIHRyeSB7XG4gICAgYnVpbGRUb29sc0RpcnMgPSBidWlsZFRvb2xzRGlyc1xuICAgICAgLm1hcCgoZGlyKSA9PiBbcGF0aC5iYXNlbmFtZShkaXIpLCBkaXJdKVxuICAgICAgLnNvcnQoKGEsIGIpID0+IHNlbXZlci5yY29tcGFyZShhWzBdLCBiWzBdKSlcbiAgICAgIC5tYXAoKHBhaXIpID0+IHBhaXJbMV0pO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cud2FybihgQ2Fubm90IHNvcnQgYnVpbGQtdG9vbHMgZm9sZGVycyAke0pTT04uc3RyaW5naWZ5KGJ1aWxkVG9vbHNEaXJzLm1hcCgoZGlyKSA9PiBwYXRoLmJhc2VuYW1lKGRpcikpKX0gYCArXG4gICAgICBgYnkgc2VtYW50aWMgdmVyc2lvbiBuYW1lcy5gKTtcbiAgICBsb2cud2FybihgRmFsbGluZyBiYWNrIHRvIHNvcnRpbmcgYnkgbW9kaWZpY2F0aW9uIGRhdGUuIE9yaWdpbmFsIGVycm9yOiAke2Vyci5tZXNzYWdlfWApO1xuICAgIGNvbnN0IHBhaXJzID0gYXdhaXQgQi5tYXAoYnVpbGRUb29sc0RpcnMsIGFzeW5jIChkaXIpID0+IFsoYXdhaXQgZnMuc3RhdChkaXIpKS5tdGltZS52YWx1ZU9mKCksIGRpcl0pO1xuICAgIGJ1aWxkVG9vbHNEaXJzID0gcGFpcnNcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBhWzBdIDwgYlswXSlcbiAgICAgIC5tYXAoKHBhaXIpID0+IHBhaXJbMV0pO1xuICB9XG4gIGxvZy5pbmZvKGBGb3VuZCAke2J1aWxkVG9vbHNEaXJzLmxlbmd0aH0gJ2J1aWxkLXRvb2xzJyBmb2xkZXJzIHVuZGVyICcke3Nka1Jvb3R9JyAobmV3ZXN0IGZpcnN0KTpgKTtcbiAgZm9yIChsZXQgZGlyIG9mIGJ1aWxkVG9vbHNEaXJzKSB7XG4gICAgbG9nLmluZm8oYCAgICAke2Rpcn1gKTtcbiAgfVxuICByZXR1cm4gYnVpbGRUb29sc0RpcnM7XG59KTtcblxuLyoqXG4gKiBSZXRyaWV2ZXMgdGhlIGxpc3Qgb2YgcGVybWlzc2lvbiBuYW1lcyBlbmNvZGVkIGluIGBkdW1wc3lzIHBhY2thZ2VgIGNvbW1hbmQgb3V0cHV0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBkdW1wc3lzT3V0cHV0IC0gVGhlIGFjdHVhbCBjb21tYW5kIG91dHB1dC5cbiAqIEBwYXJhbSB7QXJyYXk8c3RyaW5nPn0gZ3JvdXBOYW1lcyAtIFRoZSBsaXN0IG9mIGdyb3VwIG5hbWVzIHRvIGxpc3QgcGVybWlzc2lvbnMgZm9yLlxuICogQHBhcmFtIHs/Ym9vbGVhbn0gZ3JhbnRlZFN0YXRlIC0gVGhlIGV4cGVjdGVkIHN0YXRlIG9mIGBncmFudGVkYCBhdHRyaWJ1dGUgdG8gZmlsdGVyIHdpdGguXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBObyBmaWx0ZXJpbmcgaXMgZG9uZSBpZiB0aGUgcGFyYW1ldGVyIGlzIG5vdCBzZXQuXG4gKiBAcmV0dXJucyB7QXJyYXk8c3RyaW5nPn0gVGhlIGxpc3Qgb2YgbWF0Y2hlZCBwZXJtaXNzaW9uIG5hbWVzIG9yIGFuIGVtcHR5IGxpc3QgaWYgbm8gbWF0Y2hlcyB3ZXJlIGZvdW5kLlxuICovXG5jb25zdCBleHRyYWN0TWF0Y2hpbmdQZXJtaXNzaW9ucyA9IGZ1bmN0aW9uIChkdW1wc3lzT3V0cHV0LCBncm91cE5hbWVzLCBncmFudGVkU3RhdGUgPSBudWxsKSB7XG4gIGNvbnN0IGdyb3VwUGF0dGVybkJ5TmFtZSA9IChncm91cE5hbWUpID0+IG5ldyBSZWdFeHAoYF4oXFxcXHMqJHtfLmVzY2FwZVJlZ0V4cChncm91cE5hbWUpfSBwZXJtaXNzaW9uczpbXFxcXHNcXFxcU10rKWAsICdtJyk7XG4gIGNvbnN0IGluZGVudFBhdHRlcm4gPSAvXFxTfCQvO1xuICBjb25zdCBwZXJtaXNzaW9uTmFtZVBhdHRlcm4gPSAvYW5kcm9pZFxcLlxcdypcXC4/cGVybWlzc2lvblxcLlxcdysvO1xuICBjb25zdCBncmFudGVkU3RhdGVQYXR0ZXJuID0gL1xcYmdyYW50ZWQ9KFxcdyspLztcbiAgY29uc3QgcmVzdWx0ID0gW107XG4gIGZvciAoY29uc3QgZ3JvdXBOYW1lIG9mIGdyb3VwTmFtZXMpIHtcbiAgICBjb25zdCBncm91cE1hdGNoID0gZ3JvdXBQYXR0ZXJuQnlOYW1lKGdyb3VwTmFtZSkuZXhlYyhkdW1wc3lzT3V0cHV0KTtcbiAgICBpZiAoIWdyb3VwTWF0Y2gpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGNvbnN0IGxpbmVzID0gZ3JvdXBNYXRjaFsxXS5zcGxpdCgnXFxuJyk7XG4gICAgaWYgKGxpbmVzLmxlbmd0aCA8IDIpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGNvbnN0IHRpdGxlSW5kZW50ID0gbGluZXNbMF0uc2VhcmNoKGluZGVudFBhdHRlcm4pO1xuICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcy5zbGljZSgxKSkge1xuICAgICAgY29uc3QgY3VycmVudEluZGVudCA9IGxpbmUuc2VhcmNoKGluZGVudFBhdHRlcm4pO1xuICAgICAgaWYgKGN1cnJlbnRJbmRlbnQgPD0gdGl0bGVJbmRlbnQpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHBlcm1pc3Npb25OYW1lTWF0Y2ggPSBwZXJtaXNzaW9uTmFtZVBhdHRlcm4uZXhlYyhsaW5lKTtcbiAgICAgIGlmICghcGVybWlzc2lvbk5hbWVNYXRjaCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGl0ZW0gPSB7XG4gICAgICAgIHBlcm1pc3Npb246IHBlcm1pc3Npb25OYW1lTWF0Y2hbMF0sXG4gICAgICB9O1xuICAgICAgY29uc3QgZ3JhbnRlZFN0YXRlTWF0Y2ggPSBncmFudGVkU3RhdGVQYXR0ZXJuLmV4ZWMobGluZSk7XG4gICAgICBpZiAoZ3JhbnRlZFN0YXRlTWF0Y2gpIHtcbiAgICAgICAgaXRlbS5ncmFudGVkID0gZ3JhbnRlZFN0YXRlTWF0Y2hbMV0gPT09ICd0cnVlJztcbiAgICAgIH1cbiAgICAgIHJlc3VsdC5wdXNoKGl0ZW0pO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGZpbHRlcmVkUmVzdWx0ID0gcmVzdWx0XG4gICAgLmZpbHRlcigoaXRlbSkgPT4gIV8uaXNCb29sZWFuKGdyYW50ZWRTdGF0ZSkgfHwgaXRlbS5ncmFudGVkID09PSBncmFudGVkU3RhdGUpXG4gICAgLm1hcCgoaXRlbSkgPT4gaXRlbS5wZXJtaXNzaW9uKTtcbiAgbG9nLmRlYnVnKGBSZXRyaWV2ZWQgJHt1dGlsLnBsdXJhbGl6ZSgncGVybWlzc2lvbicsIGZpbHRlcmVkUmVzdWx0Lmxlbmd0aCwgdHJ1ZSl9IGAgK1xuICAgIGBmcm9tICR7Z3JvdXBOYW1lc30gJHt1dGlsLnBsdXJhbGl6ZSgnZ3JvdXAnLCBncm91cE5hbWVzLmxlbmd0aCwgZmFsc2UpfWApO1xuICByZXR1cm4gZmlsdGVyZWRSZXN1bHQ7XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IEluc3RhbGxPcHRpb25zXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGFsbG93VGVzdFBhY2thZ2VzIFtmYWxzZV0gLSBTZXQgdG8gdHJ1ZSBpbiBvcmRlciB0byBhbGxvdyB0ZXN0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWNrYWdlcyBpbnN0YWxsYXRpb24uXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IHVzZVNkY2FyZCBbZmFsc2VdIC0gU2V0IHRvIHRydWUgdG8gaW5zdGFsbCB0aGUgYXBwIG9uIHNkY2FyZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RlYWQgb2YgdGhlIGRldmljZSBtZW1vcnkuXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IGdyYW50UGVybWlzc2lvbnMgW2ZhbHNlXSAtIFNldCB0byB0cnVlIGluIG9yZGVyIHRvIGdyYW50IGFsbCB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbnMgcmVxdWVzdGVkIGluIHRoZSBhcHBsaWNhdGlvbidzIG1hbmlmZXN0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dG9tYXRpY2FsbHkgYWZ0ZXIgdGhlIGluc3RhbGxhdGlvbiBpcyBjb21wbGV0ZWRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5kZXIgQW5kcm9pZCA2Ky5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gcmVwbGFjZSBbdHJ1ZV0gLSBTZXQgaXQgdG8gZmFsc2UgaWYgeW91IGRvbid0IHdhbnRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGUgYXBwbGljYXRpb24gdG8gYmUgdXBncmFkZWQvcmVpbnN0YWxsZWRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpdCBpcyBhbHJlYWR5IHByZXNlbnQgb24gdGhlIGRldmljZS5cbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gcGFydGlhbEluc3RhbGwgW2ZhbHNlXSAtIEluc3RhbGwgYXBrcyBwYXJ0aWFsbHkuIEl0IGlzIHVzZWQgZm9yICdpbnN0YWxsLW11bHRpcGxlJy5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHR0cHM6Ly9hbmRyb2lkLnN0YWNrZXhjaGFuZ2UuY29tL3F1ZXN0aW9ucy8xMTEwNjQvd2hhdC1pcy1hLXBhcnRpYWwtYXBwbGljYXRpb24taW5zdGFsbC12aWEtYWRiXG4gKi9cblxuLyoqXG4gKiBUcmFuc2Zvcm1zIGdpdmVuIG9wdGlvbnMgaW50byB0aGUgbGlzdCBvZiBgYWRiIGluc3RhbGwuaW5zdGFsbC1tdWx0aXBsZWAgY29tbWFuZCBhcmd1bWVudHNcbiAqXG4gKiBAcGFyYW0ge251bWJlcn0gYXBpTGV2ZWwgLSBUaGUgY3VycmVudCBBUEkgbGV2ZWxcbiAqIEBwYXJhbSB7P0luc3RhbGxPcHRpb25zfSBvcHRpb25zIC0gVGhlIG9wdGlvbnMgbWFwcGluZyB0byB0cmFuc2Zvcm1cbiAqIEByZXR1cm5zIHtBcnJheTxTdHJpbmc+fSBUaGUgYXJyYXkgb2YgYXJndW1lbnRzXG4gKi9cbmZ1bmN0aW9uIGJ1aWxkSW5zdGFsbEFyZ3MgKGFwaUxldmVsLCBvcHRpb25zID0ge30pIHtcbiAgY29uc3QgcmVzdWx0ID0gW107XG5cbiAgaWYgKCF1dGlsLmhhc1ZhbHVlKG9wdGlvbnMucmVwbGFjZSkgfHwgb3B0aW9ucy5yZXBsYWNlKSB7XG4gICAgcmVzdWx0LnB1c2goJy1yJyk7XG4gIH1cbiAgaWYgKG9wdGlvbnMuYWxsb3dUZXN0UGFja2FnZXMpIHtcbiAgICByZXN1bHQucHVzaCgnLXQnKTtcbiAgfVxuICBpZiAob3B0aW9ucy51c2VTZGNhcmQpIHtcbiAgICByZXN1bHQucHVzaCgnLXMnKTtcbiAgfVxuICBpZiAob3B0aW9ucy5ncmFudFBlcm1pc3Npb25zKSB7XG4gICAgaWYgKGFwaUxldmVsIDwgMjMpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgU2tpcHBpbmcgcGVybWlzc2lvbnMgZ3JhbnQgb3B0aW9uLCBzaW5jZSBgICtcbiAgICAgICAgICAgICAgICBgdGhlIGN1cnJlbnQgQVBJIGxldmVsICR7YXBpTGV2ZWx9IGRvZXMgbm90IHN1cHBvcnQgYXBwbGljYXRpb25zIGAgK1xuICAgICAgICAgICAgICAgIGBwZXJtaXNzaW9ucyBjdXN0b21pemF0aW9uYCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdC5wdXNoKCctZycpO1xuICAgIH1cbiAgfVxuICAvLyBGb3IgbXVsdGlwbGUtaW5zdGFsbFxuICBpZiAob3B0aW9ucy5wYXJ0aWFsSW5zdGFsbCkge1xuICAgIHJlc3VsdC5wdXNoKCctcCcpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBNYW5pZmVzdEluZm9cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBwa2cgLSBUaGUgYXBwbGljYXRpb24gaWRlbnRpZmllclxuICogQHByb3BlcnR5IHtzdHJpbmd9IGFjdGl2aXR5IC0gVGhlIG5hbWUgb2YgdGhlIG1haW4gcGFja2FnZSBhY3Rpdml0eVxuICogQHByb3BlcnR5IHs/bnVtYmVyfSB2ZXJzaW9uQ29kZSAtIFRoZSB2ZXJzaW9uIGNvZGUgbnVtYmVyIChtaWdodCBiZSBgTmFOYClcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gdmVyc2lvbk5hbWUgLSBUaGUgdmVyc2lvbiBuYW1lIChtaWdodCBiZSBgbnVsbGApXG4gKi9cblxuLyoqXG4gKiBQZXJmb3JtIHBhcnNpbmcgb2YgdGhlIG1hbmlmZXN0IG9iamVjdCBpbiBvcmRlclxuICogdG8gZXh0cmFjdCBzb21lIHZpdGFsIHZhbHVlcyBmcm9tIGl0XG4gKlxuICogQHBhcmFtIHtvYmplY3R9IG1hbmlmZXN0IFRoZSBtYW5pZmVzdCBjb250ZW50IGZvcm1hdHRlZCBhcyBKU09OXG4gKiBTZWUgaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvYWRia2l0LWFwa3JlYWRlciBmb3IgZGV0YWlsZWQgZm9ybWF0IGRlc2NyaXB0aW9uXG4gKiBAcmV0dXJucyB7TWFuaWZlc3RJbmZvfVxuICovXG5mdW5jdGlvbiBwYXJzZU1hbmlmZXN0IChtYW5pZmVzdCkge1xuICBjb25zdCByZXN1bHQgPSB7XG4gICAgcGtnOiBtYW5pZmVzdC5wYWNrYWdlLFxuICAgIHZlcnNpb25Db2RlOiBwYXJzZUludChtYW5pZmVzdC52ZXJzaW9uQ29kZSwgMTApLFxuICAgIHZlcnNpb25OYW1lOiBtYW5pZmVzdC52ZXJzaW9uTmFtZSB8fCBudWxsLFxuICB9O1xuICBpZiAoIW1hbmlmZXN0LmFwcGxpY2F0aW9uKSB7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8vIExvb2sgZm9yIGVuYWJsZWQgYWN0aXZpdHkgb3IgYWN0aXZpdHktYWxpYXMgd2l0aFxuICAvLyBhY3Rpb24gPT0gYW5kcm9pZC5pbnRlbnQuYWN0aW9uLk1BSU4gYW5kXG4gIC8vIGNhdGVnb3J5ID09IGFuZHJvaWQuaW50ZW50LmNhdGVnb3J5LkxBVU5DSEVSXG4gIGZvciAoY29uc3QgYWN0aXZpdHkgb2YgW1xuICAgIC4uLm1hbmlmZXN0LmFwcGxpY2F0aW9uLmFjdGl2aXRpZXMsXG4gICAgLi4ubWFuaWZlc3QuYXBwbGljYXRpb24uYWN0aXZpdHlBbGlhc2VzLFxuICBdKSB7XG4gICAgaWYgKGFjdGl2aXR5LmVuYWJsZWQgPT09IGZhbHNlIHx8IF8uaXNFbXB0eShhY3Rpdml0eS5pbnRlbnRGaWx0ZXJzKSkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgZm9yIChjb25zdCB7YWN0aW9ucywgY2F0ZWdvcmllc30gb2YgYWN0aXZpdHkuaW50ZW50RmlsdGVycykge1xuICAgICAgaWYgKF8uaXNFbXB0eShhY3Rpb25zKSB8fCBfLmlzRW1wdHkoY2F0ZWdvcmllcykpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGlzTWFpbkFjdGlvbiA9IGFjdGlvbnNcbiAgICAgICAgLnNvbWUoKHtuYW1lfSkgPT4gbmFtZSA9PT0gJ2FuZHJvaWQuaW50ZW50LmFjdGlvbi5NQUlOJyk7XG4gICAgICBjb25zdCBpc0xhdW5jaGVyQ2F0ZWdvcnkgPSBjYXRlZ29yaWVzXG4gICAgICAgIC5zb21lKCh7bmFtZX0pID0+IG5hbWUgPT09ICdhbmRyb2lkLmludGVudC5jYXRlZ29yeS5MQVVOQ0hFUicpO1xuICAgICAgaWYgKGlzTWFpbkFjdGlvbiAmJiBpc0xhdW5jaGVyQ2F0ZWdvcnkpIHtcbiAgICAgICAgcmVzdWx0LmFjdGl2aXR5ID0gYWN0aXZpdHkubmFtZTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLyoqXG4gKiBQYXJzZXMgYXBrIHN0cmluZ3MgZnJvbSBhYXB0IHRvb2wgb3V0cHV0XG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHJhd091dHB1dCBUaGUgYWN0dWFsIHRvb2wgb3V0cHV0XG4gKiBAcGFyYW0ge3N0cmluZ30gY29uZmlnTWFya2VyIFRoZSBjb25maWcgbWFya2VyLiBVc3VhbGx5XG4gKiBhIGxhbmd1YWdlIGFiYnJldmlhdGlvbiBvciBgKGRlZmF1bHQpYFxuICogQHJldHVybnMge09iamVjdH0gU3RyaW5ncyBpZHMgdG8gdmFsdWVzIG1hcHBpbmcuIFBsdXJhbFxuICogdmFsdWVzIGFyZSByZXByZXNlbnRlZCBhcyBhcnJheXMuIElmIG5vIGNvbmZpZyBmb3VuZCBmb3IgdGhlXG4gKiBnaXZlbiBtYXJrZXIgdGhlbiBhbiBlbXB0eSBtYXBwaW5nIGlzIHJldHVybmVkLlxuICovXG5mdW5jdGlvbiBwYXJzZUFhcHRTdHJpbmdzIChyYXdPdXRwdXQsIGNvbmZpZ01hcmtlcikge1xuICBjb25zdCBub3JtYWxpemVTdHJpbmdNYXRjaCA9IGZ1bmN0aW9uIChzKSB7XG4gICAgcmV0dXJuIHMucmVwbGFjZSgvXCIkLywgJycpLnJlcGxhY2UoL15cIi8sICcnKS5yZXBsYWNlKC9cXFxcXCIvZywgJ1wiJyk7XG4gIH07XG5cbiAgY29uc3QgYXBrU3RyaW5ncyA9IHt9O1xuICBsZXQgaXNJbkNvbmZpZyA9IGZhbHNlO1xuICBsZXQgY3VycmVudFJlc291cmNlSWQgPSBudWxsO1xuICBsZXQgaXNJblBsdXJhbEdyb3VwID0gZmFsc2U7XG4gIC8vIFRoZSBwYXR0ZXJuIG1hdGNoZXMgYW55IHF1b3RlZCBjb250ZW50IGluY2x1ZGluZyBlc2NhcGVkIHF1b3Rlc1xuICBjb25zdCBxdW90ZWRTdHJpbmdQYXR0ZXJuID0gL1wiW15cIlxcXFxdKig/OlxcXFwuW15cIlxcXFxdKikqXCIvO1xuICBmb3IgKGNvbnN0IGxpbmUgb2YgcmF3T3V0cHV0LnNwbGl0KG9zLkVPTCkpIHtcbiAgICBjb25zdCB0cmltbWVkTGluZSA9IGxpbmUudHJpbSgpO1xuICAgIGlmIChfLmlzRW1wdHkodHJpbW1lZExpbmUpKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBpZiAoWydjb25maWcnLCAndHlwZScsICdzcGVjJywgJ1BhY2thZ2UnXS5zb21lKCh4KSA9PiB0cmltbWVkTGluZS5zdGFydHNXaXRoKHgpKSkge1xuICAgICAgaXNJbkNvbmZpZyA9IHRyaW1tZWRMaW5lLnN0YXJ0c1dpdGgoYGNvbmZpZyAke2NvbmZpZ01hcmtlcn06YCk7XG4gICAgICBjdXJyZW50UmVzb3VyY2VJZCA9IG51bGw7XG4gICAgICBpc0luUGx1cmFsR3JvdXAgPSBmYWxzZTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmICghaXNJbkNvbmZpZykge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgaWYgKHRyaW1tZWRMaW5lLnN0YXJ0c1dpdGgoJ3Jlc291cmNlJykpIHtcbiAgICAgIGlzSW5QbHVyYWxHcm91cCA9IGZhbHNlO1xuICAgICAgY3VycmVudFJlc291cmNlSWQgPSBudWxsO1xuXG4gICAgICBpZiAodHJpbW1lZExpbmUuaW5jbHVkZXMoJzpzdHJpbmcvJykpIHtcbiAgICAgICAgY29uc3QgbWF0Y2ggPSAvOnN0cmluZ1xcLyhcXFMrKTovLmV4ZWModHJpbW1lZExpbmUpO1xuICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICBjdXJyZW50UmVzb3VyY2VJZCA9IG1hdGNoWzFdO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRyaW1tZWRMaW5lLmluY2x1ZGVzKCc6cGx1cmFscy8nKSkge1xuICAgICAgICBjb25zdCBtYXRjaCA9IC86cGx1cmFsc1xcLyhcXFMrKTovLmV4ZWModHJpbW1lZExpbmUpO1xuICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICBjdXJyZW50UmVzb3VyY2VJZCA9IG1hdGNoWzFdO1xuICAgICAgICAgIGlzSW5QbHVyYWxHcm91cCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmIChjdXJyZW50UmVzb3VyY2VJZCAmJiB0cmltbWVkTGluZS5zdGFydHNXaXRoKCcoc3RyaW5nJykpIHtcbiAgICAgIGNvbnN0IG1hdGNoID0gcXVvdGVkU3RyaW5nUGF0dGVybi5leGVjKHRyaW1tZWRMaW5lKTtcbiAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICBhcGtTdHJpbmdzW2N1cnJlbnRSZXNvdXJjZUlkXSA9IG5vcm1hbGl6ZVN0cmluZ01hdGNoKG1hdGNoWzBdKTtcbiAgICAgIH1cbiAgICAgIGN1cnJlbnRSZXNvdXJjZUlkID0gbnVsbDtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmIChjdXJyZW50UmVzb3VyY2VJZCAmJiBpc0luUGx1cmFsR3JvdXAgJiYgdHJpbW1lZExpbmUuaW5jbHVkZXMoJzogKHN0cmluZycpKSB7XG4gICAgICBjb25zdCBtYXRjaCA9IHF1b3RlZFN0cmluZ1BhdHRlcm4uZXhlYyh0cmltbWVkTGluZSk7XG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgYXBrU3RyaW5nc1tjdXJyZW50UmVzb3VyY2VJZF0gPSBbXG4gICAgICAgICAgLi4uKGFwa1N0cmluZ3NbY3VycmVudFJlc291cmNlSWRdIHx8IFtdKSxcbiAgICAgICAgICBub3JtYWxpemVTdHJpbmdNYXRjaChtYXRjaFswXSksXG4gICAgICAgIF07XG4gICAgICB9XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGFwa1N0cmluZ3M7XG59XG5cbi8qKlxuICogUGFyc2VzIGFwayBzdHJpbmdzIGZyb20gYWFwdDIgdG9vbCBvdXRwdXRcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcmF3T3V0cHV0IFRoZSBhY3R1YWwgdG9vbCBvdXRwdXRcbiAqIEBwYXJhbSB7c3RyaW5nfSBjb25maWdNYXJrZXIgVGhlIGNvbmZpZyBtYXJrZXIuIFVzdWFsbHlcbiAqIGEgbGFuZ3VhZ2UgYWJicmV2aWF0aW9uIG9yIGFuIGVtcHR5IHN0cmluZyBmb3IgdGhlIGRlZmF1bHQgb25lXG4gKiBAcmV0dXJucyB7T2JqZWN0fSBTdHJpbmdzIGlkcyB0byB2YWx1ZXMgbWFwcGluZy4gUGx1cmFsXG4gKiB2YWx1ZXMgYXJlIHJlcHJlc2VudGVkIGFzIGFycmF5cy4gSWYgbm8gY29uZmlnIGZvdW5kIGZvciB0aGVcbiAqIGdpdmVuIG1hcmtlciB0aGVuIGFuIGVtcHR5IG1hcHBpbmcgaXMgcmV0dXJuZWQuXG4gKi9cbmZ1bmN0aW9uIHBhcnNlQWFwdDJTdHJpbmdzIChyYXdPdXRwdXQsIGNvbmZpZ01hcmtlcikge1xuICBjb25zdCBhbGxMaW5lcyA9IHJhd091dHB1dC5zcGxpdChvcy5FT0wpO1xuICBmdW5jdGlvbiBleHRyYWN0Q29udGVudCAoc3RhcnRJZHgpIHtcbiAgICBsZXQgaWR4ID0gc3RhcnRJZHg7XG4gICAgY29uc3Qgc3RhcnRDaGFyUG9zID0gYWxsTGluZXNbc3RhcnRJZHhdLmluZGV4T2YoJ1wiJyk7XG4gICAgaWYgKHN0YXJ0Q2hhclBvcyA8IDApIHtcbiAgICAgIHJldHVybiBbbnVsbCwgaWR4XTtcbiAgICB9XG4gICAgbGV0IHJlc3VsdCA9ICcnO1xuICAgIHdoaWxlIChpZHggPCBhbGxMaW5lcy5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IHRlcm1pbmF0aW9uQ2hhck1hdGNoID0gL1wiJC8uZXhlYyhhbGxMaW5lc1tpZHhdKTtcbiAgICAgIGlmICh0ZXJtaW5hdGlvbkNoYXJNYXRjaCkge1xuICAgICAgICBjb25zdCB0ZXJtaW5hdGlvbkNoYXJQb3MgPSB0ZXJtaW5hdGlvbkNoYXJNYXRjaC5pbmRleDtcbiAgICAgICAgaWYgKHN0YXJ0SWR4ID09PSBpZHgpIHtcbiAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgYWxsTGluZXNbaWR4XS5zdWJzdHJpbmcoc3RhcnRDaGFyUG9zICsgMSwgdGVybWluYXRpb25DaGFyUG9zKSxcbiAgICAgICAgICAgIGlkeFxuICAgICAgICAgIF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICBgJHtyZXN1bHR9XFxcXG4ke18udHJpbVN0YXJ0KGFsbExpbmVzW2lkeF0uc3Vic3RyaW5nKDAsIHRlcm1pbmF0aW9uQ2hhclBvcykpfWAsXG4gICAgICAgICAgaWR4LFxuICAgICAgICBdO1xuICAgICAgfVxuICAgICAgaWYgKGlkeCA+IHN0YXJ0SWR4KSB7XG4gICAgICAgIHJlc3VsdCArPSBgXFxcXG4ke18udHJpbVN0YXJ0KGFsbExpbmVzW2lkeF0pfWA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHQgKz0gYWxsTGluZXNbaWR4XS5zdWJzdHJpbmcoc3RhcnRDaGFyUG9zICsgMSk7XG4gICAgICB9XG4gICAgICArK2lkeDtcbiAgICB9XG4gICAgcmV0dXJuIFtyZXN1bHQsIGlkeF07XG4gIH1cblxuICBjb25zdCBhcGtTdHJpbmdzID0ge307XG4gIGxldCBjdXJyZW50UmVzb3VyY2VJZCA9IG51bGw7XG4gIGxldCBpc0luUGx1cmFsR3JvdXAgPSBmYWxzZTtcbiAgbGV0IGlzSW5DdXJyZW50Q29uZmlnID0gZmFsc2U7XG4gIGxldCBsaW5lSW5kZXggPSAwO1xuICB3aGlsZSAobGluZUluZGV4IDwgYWxsTGluZXMubGVuZ3RoKSB7XG4gICAgY29uc3QgdHJpbW1lZExpbmUgPSBhbGxMaW5lc1tsaW5lSW5kZXhdLnRyaW0oKTtcbiAgICBpZiAoXy5pc0VtcHR5KHRyaW1tZWRMaW5lKSkge1xuICAgICAgKytsaW5lSW5kZXg7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBpZiAoWyd0eXBlJywgJ1BhY2thZ2UnXS5zb21lKCh4KSA9PiB0cmltbWVkTGluZS5zdGFydHNXaXRoKHgpKSkge1xuICAgICAgY3VycmVudFJlc291cmNlSWQgPSBudWxsO1xuICAgICAgaXNJblBsdXJhbEdyb3VwID0gZmFsc2U7XG4gICAgICBpc0luQ3VycmVudENvbmZpZyA9IGZhbHNlO1xuICAgICAgKytsaW5lSW5kZXg7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBpZiAodHJpbW1lZExpbmUuc3RhcnRzV2l0aCgncmVzb3VyY2UnKSkge1xuICAgICAgaXNJblBsdXJhbEdyb3VwID0gZmFsc2U7XG4gICAgICBjdXJyZW50UmVzb3VyY2VJZCA9IG51bGw7XG4gICAgICBpc0luQ3VycmVudENvbmZpZyA9IGZhbHNlO1xuXG4gICAgICBpZiAodHJpbW1lZExpbmUuaW5jbHVkZXMoJ3N0cmluZy8nKSkge1xuICAgICAgICBjb25zdCBtYXRjaCA9IC9zdHJpbmdcXC8oXFxTKykvLmV4ZWModHJpbW1lZExpbmUpO1xuICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICBjdXJyZW50UmVzb3VyY2VJZCA9IG1hdGNoWzFdO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRyaW1tZWRMaW5lLmluY2x1ZGVzKCdwbHVyYWxzLycpKSB7XG4gICAgICAgIGNvbnN0IG1hdGNoID0gL3BsdXJhbHNcXC8oXFxTKykvLmV4ZWModHJpbW1lZExpbmUpO1xuICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICBjdXJyZW50UmVzb3VyY2VJZCA9IG1hdGNoWzFdO1xuICAgICAgICAgIGlzSW5QbHVyYWxHcm91cCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgICsrbGluZUluZGV4O1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgaWYgKGN1cnJlbnRSZXNvdXJjZUlkKSB7XG4gICAgICBpZiAoaXNJblBsdXJhbEdyb3VwKSB7XG4gICAgICAgIGlmICh0cmltbWVkTGluZS5zdGFydHNXaXRoKCcoJykpIHtcbiAgICAgICAgICBpc0luQ3VycmVudENvbmZpZyA9IHRyaW1tZWRMaW5lLnN0YXJ0c1dpdGgoYCgke2NvbmZpZ01hcmtlcn0pYCk7XG4gICAgICAgICAgKytsaW5lSW5kZXg7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzSW5DdXJyZW50Q29uZmlnKSB7XG4gICAgICAgICAgY29uc3QgW2NvbnRlbnQsIGlkeF0gPSBleHRyYWN0Q29udGVudChsaW5lSW5kZXgpO1xuICAgICAgICAgIGxpbmVJbmRleCA9IGlkeDtcbiAgICAgICAgICBpZiAoXy5pc1N0cmluZyhjb250ZW50KSkge1xuICAgICAgICAgICAgYXBrU3RyaW5nc1tjdXJyZW50UmVzb3VyY2VJZF0gPSBbXG4gICAgICAgICAgICAgIC4uLihhcGtTdHJpbmdzW2N1cnJlbnRSZXNvdXJjZUlkXSB8fCBbXSksXG4gICAgICAgICAgICAgIGNvbnRlbnQsXG4gICAgICAgICAgICBdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0cmltbWVkTGluZS5zdGFydHNXaXRoKGAoJHtjb25maWdNYXJrZXJ9KWApKSB7XG4gICAgICAgIGNvbnN0IFtjb250ZW50LCBpZHhdID0gZXh0cmFjdENvbnRlbnQobGluZUluZGV4KTtcbiAgICAgICAgbGluZUluZGV4ID0gaWR4O1xuICAgICAgICBpZiAoXy5pc1N0cmluZyhjb250ZW50KSkge1xuICAgICAgICAgIGFwa1N0cmluZ3NbY3VycmVudFJlc291cmNlSWRdID0gY29udGVudDtcbiAgICAgICAgfVxuICAgICAgICBjdXJyZW50UmVzb3VyY2VJZCA9IG51bGw7XG4gICAgICB9XG4gICAgfVxuICAgICsrbGluZUluZGV4O1xuICB9XG4gIHJldHVybiBhcGtTdHJpbmdzO1xufVxuXG4vKipcbiAqIEZvcm1hdHMgdGhlIGNvbmZpZyBtYXJrZXIsIHdoaWNoIGlzIHRoZW4gcGFzc2VkIHRvIHBhcnNlLi4gbWV0aG9kc1xuICogdG8gbWFrZSBpdCBjb21wYXRpYmxlIHdpdGggcmVzb3VyY2UgZm9ybWF0cyBnZW5lcmF0ZWQgYnkgYWFwdCgyKSB0b29sXG4gKlxuICogQHBhcmFtIHtGdW5jdGlvbn0gY29uZmlnc0dldHRlciBUaGUgZnVuY3Rpb24gd2hvc2UgcmVzdWx0IGlzIGEgbGlzdFxuICogb2YgYXBrIGNvbmZpZ3NcbiAqIEBwYXJhbSB7c3RyaW5nfSBkZXNpcmVkTWFya2VyIFRoZSBkZXNpcmVkIGNvbmZpZyBtYXJrZXIgdmFsdWVcbiAqIEBwYXJhbSB7c3RyaW5nfSBkZWZhdWx0TWFya2VyIFRoZSBkZWZhdWx0IGNvbmZpZyBtYXJrZXIgdmFsdWVcbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIGZvcm1hdHRlZCBjb25maWcgbWFya2VyXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGZvcm1hdENvbmZpZ01hcmtlciAoY29uZmlnc0dldHRlciwgZGVzaXJlZE1hcmtlciwgZGVmYXVsdE1hcmtlcikge1xuICBsZXQgY29uZmlnTWFya2VyID0gZGVzaXJlZE1hcmtlciB8fCBkZWZhdWx0TWFya2VyO1xuICBpZiAoY29uZmlnTWFya2VyLmluY2x1ZGVzKCctJykgJiYgIWNvbmZpZ01hcmtlci5pbmNsdWRlcygnLXInKSkge1xuICAgIGNvbmZpZ01hcmtlciA9IGNvbmZpZ01hcmtlci5yZXBsYWNlKCctJywgJy1yJyk7XG4gIH1cbiAgY29uc3QgY29uZmlncyA9IGF3YWl0IGNvbmZpZ3NHZXR0ZXIoKTtcbiAgbG9nLmRlYnVnKGBSZXNvdXJjZSBjb25maWd1cmF0aW9uczogJHtKU09OLnN0cmluZ2lmeShjb25maWdzKX1gKTtcbiAgLy8gQXNzdW1lIHRoZSAnZW4nIGNvbmZpZ3VyYXRpb24gaXMgdGhlIGRlZmF1bHQgb25lXG4gIGlmIChjb25maWdNYXJrZXIudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKCdlbicpXG4gICAgJiYgIWNvbmZpZ3Muc29tZSgoeCkgPT4geC50cmltKCkgPT09IGNvbmZpZ01hcmtlcikpIHtcbiAgICBsb2cuZGVidWcoYFJlc291cmNlIGNvbmZpZ3VyYXRpb24gbmFtZSAnJHtjb25maWdNYXJrZXJ9JyBpcyB1bmtub3duLiBgICtcbiAgICAgIGBSZXBsYWNpbmcgaXQgd2l0aCAnJHtkZWZhdWx0TWFya2VyfSdgKTtcbiAgICBjb25maWdNYXJrZXIgPSBkZWZhdWx0TWFya2VyO1xuICB9IGVsc2Uge1xuICAgIGxvZy5kZWJ1ZyhgU2VsZWN0ZWQgY29uZmlndXJhdGlvbjogJyR7Y29uZmlnTWFya2VyfSdgKTtcbiAgfVxuICByZXR1cm4gY29uZmlnTWFya2VyO1xufVxuXG4vKipcbiAqIFBhcnNlcyB0aGUgb3V0cHV0IGluIEpTT04gZm9ybWF0IHJldHJpZXZlZCBmcm9tXG4gKiB0aGUgY29ycmVzcG9uZGluZyBBcHBpdW0gU2V0dGluZ3MgYnJvYWRjYXN0IGNhbGxzXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG91dHB1dCBUaGUgYWN0dWFsIGNvbW1hbmQgb3V0cHV0XG4gKiBAcGFyYW0ge3N0cmluZ30gZW50aXR5TmFtZSBUaGUgbmFtZSBvZiB0aGUgZW50aXR5IHdoaWNoIGlzXG4gKiBnb2luZyB0byBiZSBwYXJzZWRcbiAqIEByZXR1cm5zIHtPYmplY3R9IFRoZSBwYXJzZWQgSlNPTiBvYmplY3RcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgb3V0cHV0IGNhbm5vdCBiZSBwYXJzZWRcbiAqIGFzIGEgdmFsaWQgSlNPTlxuICovXG5mdW5jdGlvbiBwYXJzZUpzb25EYXRhIChvdXRwdXQsIGVudGl0eU5hbWUpIHtcbiAgaWYgKCEvXFxicmVzdWx0PS0xXFxiLy50ZXN0KG91dHB1dCkgfHwgIS9cXGJkYXRhPVwiLy50ZXN0KG91dHB1dCkpIHtcbiAgICBsb2cuZGVidWcob3V0cHV0KTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCByZXRyaWV2ZSAke2VudGl0eU5hbWV9IGZyb20gdGhlIGRldmljZS4gYCArXG4gICAgICAnQ2hlY2sgdGhlIHNlcnZlciBsb2cgZm9yIG1vcmUgZGV0YWlscycpO1xuICB9XG4gIGNvbnN0IG1hdGNoID0gL1xcYmRhdGE9KFwiLispLy5leGVjKG91dHB1dCk7XG4gIGlmICghbWF0Y2gpIHtcbiAgICBsb2cuZGVidWcob3V0cHV0KTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBwYXJzZSAke2VudGl0eU5hbWV9IGZyb20gdGhlIGNvbW1hbmQgb3V0cHV0LiBgICtcbiAgICAgICdDaGVjayB0aGUgc2VydmVyIGxvZyBmb3IgbW9yZSBkZXRhaWxzJyk7XG4gIH1cbiAgY29uc3QganNvblN0ciA9IF8udHJpbShtYXRjaFsxXSkucmVwbGFjZSgvKF5cIil8KFwiJCkvZywgJycpO1xuICB0cnkge1xuICAgIHJldHVybiBKU09OLnBhcnNlKGpzb25TdHIpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgbG9nLmRlYnVnKGpzb25TdHIpO1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IHBhcnNlICR7ZW50aXR5TmFtZX0gZnJvbSB0aGUgcmVzdWx0aW5nIGRhdGEgc3RyaW5nLiBgICtcbiAgICAgICdDaGVjayB0aGUgc2VydmVyIGxvZyBmb3IgbW9yZSBkZXRhaWxzJyk7XG4gIH1cbn1cblxuLyoqXG4gKiBUcmFuc2Zvcm1zIHRoZSBnaXZlbiBsYW5ndWFnZSBhbmQgY291bnRyeSBhYmJyZXZpYXRpb25zXG4gKiB0byBBVkQgYXJndW1lbnRzIGFycmF5XG4gKlxuICogQHBhcmFtIHs/c3RyaW5nfSBsYW5ndWFnZSBMYW5ndWFnZSBuYW1lLCBmb3IgZXhhbXBsZSAnZnInXG4gKiBAcGFyYW0gez9zdHJpbmd9IGNvdW50cnkgQ291bnRyeSBuYW1lLCBmb3IgZXhhbXBsZSAnQ0EnXG4gKiBAcmV0dXJucyB7QXJyYXk8c3RyaW5nPn0gVGhlIGdlbmVyYXRlZCBhcmd1bWVudHMuIFRoZVxuICogcmVzdWx0aW5nIGFycmF5IG1pZ2h0IGJlIGVtcHR5IGlmIGJvdGggYXJndW1lbnRzIGFyZSBlbXB0eVxuICovXG5mdW5jdGlvbiB0b0F2ZExvY2FsZUFyZ3MgKGxhbmd1YWdlLCBjb3VudHJ5KSB7XG4gIGNvbnN0IHJlc3VsdCA9IFtdO1xuICBpZiAobGFuZ3VhZ2UgJiYgXy5pc1N0cmluZyhsYW5ndWFnZSkpIHtcbiAgICByZXN1bHQucHVzaCgnLXByb3AnLCBgcGVyc2lzdC5zeXMubGFuZ3VhZ2U9JHtsYW5ndWFnZS50b0xvd2VyQ2FzZSgpfWApO1xuICB9XG4gIGlmIChjb3VudHJ5ICYmIF8uaXNTdHJpbmcoY291bnRyeSkpIHtcbiAgICByZXN1bHQucHVzaCgnLXByb3AnLCBgcGVyc2lzdC5zeXMuY291bnRyeT0ke2NvdW50cnkudG9VcHBlckNhc2UoKX1gKTtcbiAgfVxuICBsZXQgbG9jYWxlO1xuICBpZiAoXy5pc1N0cmluZyhsYW5ndWFnZSkgJiYgXy5pc1N0cmluZyhjb3VudHJ5KSAmJiBsYW5ndWFnZSAmJiBjb3VudHJ5KSB7XG4gICAgbG9jYWxlID0gbGFuZ3VhZ2UudG9Mb3dlckNhc2UoKSArICctJyArIGNvdW50cnkudG9VcHBlckNhc2UoKTtcbiAgfSBlbHNlIGlmIChsYW5ndWFnZSAmJiBfLmlzU3RyaW5nKGxhbmd1YWdlKSkge1xuICAgIGxvY2FsZSA9IGxhbmd1YWdlLnRvTG93ZXJDYXNlKCk7XG4gIH0gZWxzZSBpZiAoY291bnRyeSAmJiBfLmlzU3RyaW5nKGNvdW50cnkpKSB7XG4gICAgbG9jYWxlID0gY291bnRyeTtcbiAgfVxuICBpZiAobG9jYWxlKSB7XG4gICAgcmVzdWx0LnB1c2goJy1wcm9wJywgYHBlcnNpc3Quc3lzLmxvY2FsZT0ke2xvY2FsZX1gKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG4vKipcbiAqIFJldHJpZXZlcyB0aGUgZnVsbCBwYXRoIHRvIHRoZSBBbmRyb2lkIHByZWZlcmVuY2VzIHJvb3RcbiAqXG4gKiBAcmV0dXJucyB7P3N0cmluZ30gVGhlIGZ1bGwgcGF0aCB0byB0aGUgZm9sZGVyIG9yIGBudWxsYCBpZiB0aGUgZm9sZGVyIGNhbm5vdCBiZSBmb3VuZFxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRBbmRyb2lkUHJlZnNSb290ICgpIHtcbiAgbGV0IGxvY2F0aW9uID0gcHJvY2Vzcy5lbnYuQU5EUk9JRF9FTVVMQVRPUl9IT01FO1xuICBpZiAoYXdhaXQgZGlyRXhpc3RzKGxvY2F0aW9uKSkge1xuICAgIHJldHVybiBsb2NhdGlvbjtcbiAgfVxuXG4gIGlmIChsb2NhdGlvbikge1xuICAgIGxvZy53YXJuKGBUaGUgdmFsdWUgb2YgdGhlIEFORFJPSURfRU1VTEFUT1JfSE9NRSBlbnZpcm9ubWVudCB2YXJpYWJsZSAnJHtsb2NhdGlvbn0nIGlzIG5vdCBhbiBleGlzdGluZyBkaXJlY3RvcnlgKTtcbiAgfVxuXG4gIGNvbnN0IGhvbWUgPSBwcm9jZXNzLmVudi5IT01FIHx8IHByb2Nlc3MuZW52LlVTRVJQUk9GSUxFO1xuICBpZiAoaG9tZSkge1xuICAgIGxvY2F0aW9uID0gcGF0aC5yZXNvbHZlKGhvbWUsICcuYW5kcm9pZCcpO1xuICB9XG5cbiAgaWYgKCFhd2FpdCBkaXJFeGlzdHMobG9jYXRpb24pKSB7XG4gICAgbG9nLmRlYnVnKGBBbmRyb2lkIGNvbmZpZyByb290ICcke2xvY2F0aW9ufScgaXMgbm90IGFuIGV4aXN0aW5nIGRpcmVjdG9yeWApO1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcmV0dXJuIGxvY2F0aW9uO1xufVxuXG4vKipcbiAqIENoZWNrIGlmIGEgcGF0aCBleGlzdHMgb24gdGhlIGZpbGVzeXN0ZW0gYW5kIGlzIGEgZGlyZWN0b3J5XG4gKlxuICogQHBhcmFtIHs/c3RyaW5nfSBsb2NhdGlvbiBUaGUgZnVsbCBwYXRoIHRvIHRoZSBkaXJlY3RvcnlcbiAqIEByZXR1cm5zIHtib29sZWFufVxuICovXG5hc3luYyBmdW5jdGlvbiBkaXJFeGlzdHMgKGxvY2F0aW9uKSB7XG4gIHJldHVybiBsb2NhdGlvblxuICAgICYmIGF3YWl0IGZzLmV4aXN0cyhsb2NhdGlvbilcbiAgICAmJiAoYXdhaXQgZnMuc3RhdChsb2NhdGlvbikpLmlzRGlyZWN0b3J5KCk7XG59XG5cbi8qKlxuICogRXNjYXBlcyBzcGVjaWFsIGNoYXJhY3RlcnMgaW4gY29tbWFuZCBsaW5lIGFyZ3VtZW50c1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcmcgVW5lc2NhcGVkIGFyZ3VtZW50IHN0cmluZ1xuICogQHJldHVybnMgVGhlIGVzY2FwZWQgYXJndW1lbnRcbiAqL1xuZnVuY3Rpb24gZXNjYXBlQXJnIChhcmcpIHtcbiAgYXJnID0gYCR7YXJnfWA7XG4gIGlmIChzeXN0ZW0uaXNXaW5kb3dzKCkpIHtcbiAgICByZXR1cm4gL1smXFxzXS8udGVzdChhcmcpID8gYFwiJHthcmcucmVwbGFjZSgvXCIvZywgJ1wiXCInKX1cImAgOiBhcmc7XG4gIH1cbiAgcmV0dXJuIGFyZy5yZXBsYWNlKC8mL2csICdcXFxcJicpO1xufVxuXG5leHBvcnQge1xuICBnZXRBbmRyb2lkUGxhdGZvcm1BbmRQYXRoLCB1bnppcEZpbGUsXG4gIGdldElNRUxpc3RGcm9tT3V0cHV0LCBnZXRKYXZhRm9yT3MsIGlzU2hvd2luZ0xvY2tzY3JlZW4sIGlzQ3VycmVudEZvY3VzT25LZXlndWFyZCxcbiAgZ2V0U3VyZmFjZU9yaWVudGF0aW9uLCBpc1NjcmVlbk9uRnVsbHksIGJ1aWxkU3RhcnRDbWQsIGdldEphdmFIb21lLFxuICByb290RGlyLCBnZXRTZGtUb29sc1ZlcnNpb24sIGdldEFwa3NpZ25lckZvck9zLCBnZXRCdWlsZFRvb2xzRGlycyxcbiAgZ2V0QXBrYW5hbHl6ZXJGb3JPcywgZ2V0T3BlblNzbEZvck9zLCBleHRyYWN0TWF0Y2hpbmdQZXJtaXNzaW9ucywgQVBLU19FWFRFTlNJT04sXG4gIEFQS19JTlNUQUxMX1RJTUVPVVQsIEFQS1NfSU5TVEFMTF9USU1FT1VULCBidWlsZEluc3RhbGxBcmdzLCBBUEtfRVhURU5TSU9OLFxuICBERUZBVUxUX0FEQl9FWEVDX1RJTUVPVVQsIHBhcnNlTWFuaWZlc3QsIHBhcnNlQWFwdFN0cmluZ3MsIHBhcnNlQWFwdDJTdHJpbmdzLFxuICBmb3JtYXRDb25maWdNYXJrZXIsIHBhcnNlSnNvbkRhdGEsIHVuc2lnbkFwaywgdG9BdmRMb2NhbGVBcmdzLCByZXF1aXJlU2RrUm9vdCxcbiAgZ2V0U2RrUm9vdEZyb21FbnYsIGdldEFuZHJvaWRQcmVmc1Jvb3QsIGRpckV4aXN0cywgZXNjYXBlQXJnLFxufTtcbiJdLCJmaWxlIjoibGliL2hlbHBlcnMuanMiLCJzb3VyY2VSb290IjoiLi4vLi4ifQ==
